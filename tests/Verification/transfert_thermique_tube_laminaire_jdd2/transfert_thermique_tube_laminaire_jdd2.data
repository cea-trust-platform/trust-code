# PARALLEL OK 4 #
dimension 3
pb_Multiphase pb

Domaine dom

# BEGIN MESH #
Lire_med family_names_from_group_names dom mesh channel.med
# END MESH #

# BEGIN PARTITION
Partition dom
{
    Partition_tool tranche { tranches 2 2 1 }
    larg_joint 2
    zones_name DOM
}
End
END PARTITION #

# BEGIN SCATTER
Scatter DOM.Zones dom
END SCATTER #

Schema_euler_implicite sch
Read sch
{
    tinit 0
	nb_pas_dt_max 3
    tmax 30
    seuil_statio 1e-12
    dt_impr 1e-10
    max_iter_implicite 1
    facsec 1
    solveur sets
    {
        criteres_convergence { alpha 1e-5 pression 1e8 vitesse 1e8 temperature 1e8 }
        iter_min 5
        solveur petsc cli { }
        seuil_convergence_implicite 1e30
    }
}

PolyMAC_P0  dis
option_PolyMAC_P0 {  }

Fluide_Incompressible eau_liquide
Read eau_liquide
{
    mu  Champ_Uniforme     1 .1
    rho Champ_Uniforme     1 1.
    lambda Champ_Uniforme  1 1.
    Cp Champ_Uniforme      1 100.
    beta_th Champ_Uniforme 1 0.
}

phases pb
{
    liquide { eau }
}

Associate pb dom
Associate  pb sch
Discretize pb dis

Read pb
{
    correlations
    {
    }
    QDM_Multiphase
    {
        evanescence { homogene { alpha_res 1e-3 } }
        solveur_pression petsc cli_quiet { -pc_type hypre -pc_hypre_type boomeramg -ksp_type fgmres }
        convection { amont }
        diffusion  { }
        initial_conditions
        {
            vitesse  Champ_fonc_xyz dom 3 0 0 2*10.*(1-(X*X+Y*Y)/(0.05*0.05))
            pression Champ_fonc_xyz dom 1 1e5
        }
        boundary_conditions
        {
            wall     paroi_fixe
            bottom   frontiere_ouverte_vitesse_imposee_sortie champ_front_fonc_xyz 3 0 0 2*10.*(1-(X*X+Y*Y)/(0.05*0.05))
            top      frontiere_ouverte_pression_imposee       champ_front_uniforme 1 1e5
        }
        sources
        {
        }
    }
    Masse_Multiphase
    {
        initial_conditions { alpha Champ_Fonc_xyz dom 1 1 }
        convection { amont }
        boundary_conditions
        {
            wall     paroi
            bottom   frontiere_ouverte a_ext Champ_Front_Uniforme 1 1
            top      frontiere_ouverte a_ext Champ_Front_Uniforme 1 1
        }
        sources
        {
        }
    }
    Energie_Multiphase
    {
        diffusion { }
        convection { amont }
        initial_conditions { temperature Champ_Uniforme 1 0 }
        boundary_conditions
        {
            wall    paroi_flux_impose Champ_Front_Uniforme 1 -1
            bottom  frontiere_ouverte T_ext Champ_Front_Uniforme 1 0
            top     frontiere_ouverte T_ext Champ_Front_Uniforme 1 0
        }
        sources
        {
        }
    }
    Post_processing
    {
        Definition_champs
        {
            v_analytique_stationnaire transformation
            {
                methode formule expression 1 2*10.*(1-(X*X+Y*Y)/(0.05*0.05)) localisation elem source refChamp { Pb_champ pb pression }
            }
            t_analytique_stationnaire transformation
            {
                methode formule expression 1 2*1.*Z/(10.*100.*1.*0.05)+1.*0.05/1.*(-7/24-1/4*(X*X+Y*Y)*(X*X+Y*Y)/(0.05*0.05*0.05*0.05)+(X*X+Y*Y)/(0.05*0.05))
                localisation elem source refChamp { Pb_champ pb pression }
            }
        }
        probes
        {
            v_analytique   v_analytique_stationnaire periode 1e8 segment 50  0.0 0.0 1.9 0.05 0.0 1.9
            v_trust              vitesse_liquide_eau periode 1e8 segment 50  0.0 0.0 1.9 0.05 0.0 1.9
            t_analytique_r t_analytique_stationnaire periode 1e8 segment 50  0.0 0.0 1.9 0.05 0.0 1.9
            t_trust_r        temperature_liquide_eau periode 1e8 segment 50  0.0 0.0 1.9 0.05 0.0 1.9
            t_analytique_z t_analytique_stationnaire periode 1e8 segment 100 0.0 0.0 0.0 0.0  0.0 2.0
            t_trust_z        temperature_liquide_eau periode 1e8 segment 100 0.0 0.0 0.0 0.0  0.0 2.0
        }
        Format lml
        fields dt_post 1.
        {
            vitesse_liquide_eau elem
            temperature_liquide_eau elem
        }
    }
}
Solve pb
End
