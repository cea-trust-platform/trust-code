Parameters {
	Title "Poiseuille flow in VEF 3D Channel - Re=1000"
	Description "Basical laminar flow against several meshes."
	Description "Influence of the effect of alpha factor in the EF_stab scheme"
	Description "Validated with analytic profile U(y) = 0.3/2.y.(2-y) , theorical pressure loss and friction velocity."
	
	VersionTrio_U "1.5.7"

	ParametersTrio_U Type of problem : Hydraulique 3D
	ParametersTrio_U Discretization : VEFPre1B
        ParametersTrio_U Time scheme : Euler_Implicite
        ParametersTrio_U Solving of equations : Navier Stokes_standard
        ParametersTrio_U Convection scheme : EF_stab, alpha=1 and alpha=0.2
        ParametersTrio_U Time scheme : Euler implicite
	ParametersTrio_U Type of boundary conditions : Periodicity in x and z directions, wall for y boundaries
        ParametersTrio_U Type of fluid : 'virtual'
	
   	TestCase ./Ny9 canalVEF /* jdd en annexe */
	TestCase ./Ny17 canalVEF 
	TestCase ./Ny25 canalVEF 
	TestCase ./Ny25_02 canalVEF
		
	Author "V. Barthel"
	IncludeData 2
}

Chapter {
	Title "Test Description"
	Description "Geometry : plane channel"
	Description "Dimensions : Ly=2 (=h), Lx = Lz are depending on Ny to get isotropic cells"
	Description "Initial conditions : vitesse Champ_Uniforme 3 0.1 0. 0."
	Description "Boundary conditions : The periodicity conditions need a source term to maintain the flow constant"
	Description "Canal_perio { bord periox }"
	Description "Mesh : 3x9x3 3x17x3 and 3x25x3 with Tetraedriser"
	Description "Ny=9 , Ny=17 and Ny=25"
	visu {
		Title "Mesh with Ny=9"
		width 8cm
		mesh ./Ny9/canalVEF.lata dom
		normal3D -0.6 0.1 0.8
		zoom3D  0. 0. 0.95
	}
	visu {
		Title "Mesh with Ny=17"
		width 8cm
		mesh ./Ny17/canalVEF.lata dom
		normal3D -0.6 0.1 0.8
		zoom3D  0. 0. 0.95
	}
	visu {
                Title "Mesh with Ny=25"
                width 8cm
                mesh ./Ny25/canalVEF.lata dom
                normal3D -0.6 0.1 0.8
                zoom3D  0. 0. 0.95
        }
	visu {
		Width 0cm
                pseudocolor ./Ny9/canalVEF.lata dom_dual VITESSE_X FACES
                Query Max ./Ny9/Umax
	}
	visu {
		Width 0cm
                pseudocolor ./Ny17/canalVEF.lata dom_dual VITESSE_X FACES
                Query Max ./Ny17/Umax
	}
	visu {
                Width 0cm
                pseudocolor ./Ny25/canalVEF.lata dom_dual VITESSE_X FACES
                Query Max ./Ny25/Umax
        }
	Table {
        Title "Physical properties"
        Description "Fluid domain: Helium"
        Description "No Gravity effect"
        nb_columns 1
                Label Valeur
                line {
                        legend "$\rho$ en kg/m$^3$"
                        file ./rho.dat
                }
                line {
                        legend "$\mu$ en N/m$^2$/s"
                        file ./mu.dat
                }
        }
}

Chapter {
	Title "Mean Vx velocity profile"
	Figure {
		Title "Velocity profile Vx"
		Description "The profiles given for each mesh is compared with the analytical one."
		Description ""
		Dimension 2
		RangeX 0. 2
		LabelX "y"
		RangeY 0. 0.16
		LabelY "U"
		PointSize 0.5
		legend below
		Curve {
			legend "Courbe analytique"
			origin "analytique"
			Fonction  (-0.3/2.)*x*(x-2.)
			Style linespoints
			TypeLigne 5
			}
		Curve {
			legend "Trio_U Ny=9"
			origin "Trio_U"
			file ./Ny9/Moyennes_spatiales_vitesse_rho_mu
			columns 1 2
			Style lines
			TypeLigne 1
			}
		Curve {
			legend "Trio_U Ny=17"
			origin "Trio_U"
			file ./Ny17/Moyennes_spatiales_vitesse_rho_mu
			columns 1 2
			Style lines
			TypeLigne 3
			}
		Curve {
			legend "Trio_U Ny=25"
			origin "Trio_U"
			file ./Ny25/Moyennes_spatiales_vitesse_rho_mu
			columns 1 2
			Style lines
			TypeLigne 4
			}
		}
	Table {
                Title "Relative error on Vx maximal value"
		Description "The maximal value of x velocity is not totally reached because of the numericial schemes precision."
		Description "But it is clear that the difference against the theorical value is very low for all the three meshes."
                nb_columns 3
                label Max analytic | Max Trio_U | Error(%)
                line {
                        nb_columns_file 2
                        file ./Ny9/Umax
                        columns 0.15 ($2) (0.15-$2)/0.15*100
                        legend Ny9
                	}
                line {
                        nb_columns_file 2
                        file ./Ny17/Umax
                        columns 0.15 ($2) (0.15-$2)/0.15*100
                        legend Ny17
                	}
                line {
                        nb_columns_file 2
                        file ./Ny25/Umax
                        columns 0.15 ($2) (0.15-$2)/0.15*100
                        legend Ny25
                	}
		}
	}
	Chapter {
	Title "Convergency"
	Figure {
		Title "Velocity at central point"
		Description "The figure below insures that convergency is obtained"
		Dimension 2
		RangeX 0. 2500.
		LabelX "y"
		RangeY 0.1 0.16
		LabelY "U"
		PointSize 0.5
		legend below
		Curve {
			legend "Trio_U Ny9"
			origin "Trio_U"
			file ./Ny9/canalVEF_SONDE_POINT.son
			columns 1 2
			Style lines
			TypeLigne 1
			}
		Curve {
			legend "Trio_U Ny17"
			origin "Trio_U"
			file ./Ny17/canalVEF_SONDE_POINT.son
			columns 1 2
			Style lines
			TypeLigne 3
			}
		Curve {
			legend "Trio_U Ny25"
			origin "Trio_U"
			file ./Ny25/canalVEF_SONDE_POINT.son
			columns 1 2
			Style lines
			TypeLigne 4
			}
                }
         }	
Chapter {
	Title "Pressure loss"
	Description "The next table shows the friction velocity u* and the pressure loss $\Delta$P/$\rho$/$\Delta$x for each mesh against the theorical values."
        Description ""
	Description "For theorical values"
        Description ""
        Description "- u* is given by laminar formula for a channel : Cf=$\lambda$/4 and $\lambda$=96/Rehyd. "
        Description "   As u*=sqrt(0.5*Cf*Um$^2$), it comes u*=Um*sqrt(12/Rehyd)"
	Description ""
        Description "- $\Delta$P/$\rho$/$\Delta$x is deduced by the theorical formula u*=sqrt($\Delta$P/$\rho$/$\Delta$x*V/S) "
        Description "   where and S are respectively the volume and the wall area of the geometry. For this bi-periodic channel geometry, V/S=h/2"
        Description ""
        Description "For Trio_U calculations :"
        Description ""
	Description "- u* is taken as the established value given in the file u_tau.dat (in fact the last value), issued from the data command 'traitement_particulier_canal'"
	Description ""
	Description "- $\Delta$P/$\rho$/$\Delta$x is taken as the established value given in the file *_Pressure_Gradient_pb_periox"
	Description ""
	Description "The table below shows that even if the differences between the velocity profiles and maximum Ux value against the analytical ones are low, they have a important effect on the pressure loss and the friction velocity distortion."
	Table {
                Title "Friction velocity and pressure loss for each calculation"
                nb_columns 6
                label  U* Trio_U | U* theo | Error on U* in $%$ | $\Delta$P Trio_U | $\Delta$P theo | Error on $\Delta$P in $%$
                line {
                        legend "Ny9"
                        origin "Trio_U"
                        file ./Ny9/press.dat
                        columns ($1) ($2) ($3) ($4) ($5) ($6)
                }
		line {
                        legend "Ny17"
                        origin "Trio_U"
                        file ./Ny17/press.dat
                        columns ($1) ($2) ($3) ($4) ($5) ($6)
                }
		line {
                        legend "Ny25"
                        origin "Trio_U"
                        file ./Ny25/press.dat
                        columns ($1) ($2) ($3) ($4) ($5) ($6)
                }
	 }
         }

Chapter {
	Title "Effect of the alpha coefficient for EF_stab scheme "
	Description "For the thinest mesh we make a calculation including an alpha coefficient equal to 0.2 (default 1.)"
	Description "The Ef_stab scheme is a centered scheme stabilised with an upwind scheme according to this coefficient. The more alpha is low, the more the scheme is centered."
	Figure {
		Title "Velocity profile Vx"
		Description "The profiles with alpha=1. and alpha=0.2 are compared with the analytical one."
		Description ""
		Dimension 2
		RangeX 0. 2
		LabelX "y"
		RangeY 0. 0.16
		LabelY "U"
		PointSize 0.5
		legend below
		Curve {
			legend "Courbe analytique"
			origin "analytique"
			Fonction  (-0.3/2.)*x*(x-2.)
			Style linespoints
			TypeLigne 5
			}
		Curve {
			legend "Trio_U Ny=25 alpha=1."
			origin "Trio_U"
			file ./Ny25/Moyennes_spatiales_vitesse_rho_mu
			columns 1 2
			Style lines
			TypeLigne 4
			}
		Curve {
			legend "Trio_U Ny=25 alpha=0.2"
			origin "Trio_U"
			file ./Ny25_02/Moyennes_spatiales_vitesse_rho_mu
			columns 1 2
			Style lines
			TypeLigne 3
			}
	}
	visu {
                Width 0cm
                pseudocolor ./Ny25_02/canalVEF.lata dom_dual VITESSE_X FACES
                Query Max ./Ny25_02/Umax
        }
	Table {
                Title "Relative error on Vx maximal value"
                nb_columns 3
                label Max analytic | Max Trio_U | Error(%)
                line {
                        nb_columns_file 2
                        file ./Ny25/Umax
                        columns 0.15 ($2) (0.15-$2)/0.15*100
                        legend Ny25 alpha=1.
                	}
		line {
                        nb_columns_file 2
                        file ./Ny25_02/Umax
                        columns 0.15 ($2) (0.15-$2)/0.15*100
                        legend Ny25 alpha=0.2
                	}
		}
			
	Table {
                Title "Friction velocity and pressure loss for each calculation"
                nb_columns 6
                label  U* Trio_U | U* theo | Error on U* in $%$ | $\Delta$P Trio_U | $\Delta$P theo | Error on $\Delta$P in $%$
                line {
                        legend "Ny25 alpha=1."
                        origin "Trio_U"
                        file ./Ny25/press.dat
                        columns ($1) ($2) ($3) ($4) ($5) ($6)
                }
		line {
                        legend "Ny25 alpha=0.2"
                        origin "Trio_U"
                        file ./Ny25_02/press.dat
                        columns ($1) ($2) ($3) ($4) ($5) ($6)
                }

	 }
	 }
	 Chapter {
         Title "Conclusions"
	 Description "In this laminar case, the use of a reduced value for alpha coefficient has an important positive effect on the calculated pressure loss. But using a weak alpha value can make the calculation unstable. So pay some attention for the time step not to be too high, especially using implicite scheme."
	 Description "The friction velocity is not so good despite the mesh refinement. Some work has to be done to make it better."
         }

Chapter {
        Title "Computer performance"
        tableau_performance {
        }
}

