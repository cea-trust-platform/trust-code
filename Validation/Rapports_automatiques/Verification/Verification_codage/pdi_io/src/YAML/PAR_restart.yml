# do we want to save the computation during execution?
save: true
# do we want to resume the computation from a previous one?
restart: false
# when resuming computation, are we using the same number of nodes as during checkpoint (as we have one file per node)?
sameNodeNumber: true
pdi:
  metadata: # small values for which PDI keeps a copy
    # >
    # > Metadata regarding parallelism
    # MPI communicator for my group
    nodeComm : int
    # number of processors inside my group
    nodeSize : int
    # my rank inside my group
    nodeRk : int

    # unknowns dimensions
    dim_vitesse : { type: array, subtype: int, size: 2 }
    glob_dim_vitesse : int

    dim_pression : { type: array, subtype: int, size: 2 }
    glob_dim_pression : int

    # scheme information
    last_iteration : int # last saved iteration

    # information on format
    version : int
    simple_sauvegarde : int

    # >
  data: #data we want to save/recover (fields of unknown) and timesteps
    vitesse : { type: array, subtype: double, size: [ '$dim_vitesse[0]', '$dim_vitesse[1]' ]  }
    pression : { type: array, subtype: double, size: [ '$dim_pression[0]', '$dim_pression[1]' ]  }
    temps : { type: array, subtype: double, size: [ '$last_iteration + 1' ]  }
  plugins:
    trace:  
    mpi: 
    decl_hdf5:
    # >>> READING DATA
    # Every proc from a group collectively reads their data into their assigned file
    - file: PAR_canal.sauv
      communicator: $nodeComm
      read:
        last_iteration:
          dataset: time/last_iteration
    - file: PAR_canal.sauv
      communicator: $nodeComm
      read:
        temps:
          dataset: time/t
    - file: PAR_canal.sauv
      communicator: $nodeComm
      read:
        version: 
          dataset: format_sauvegarde/version
    - file: PAR_canal.sauv
      communicator: $nodeComm
      read:
        simple_sauvegarde: 
          dataset: format_sauvegarde/simple_sauvegarde
    - file: PAR_canal.sauv
      on_event: restart_from_complete_checkpoint    
      communicator: $nodeComm
      read:
        vitesse:
          dataset: 'iter_$last_iteration/vitesse'
          dataset_selection:
            size: [1, '$dim_vitesse[0]', '$dim_vitesse[1]']
            start: ['$nodeRk', 0, 0]
        pression:
          dataset: 'iter_$last_iteration/pression'
          dataset_selection:
            size: [1, '$dim_pression[0]', '$dim_pression[1]']
            start: ['$nodeRk', 0, 0]
    - file: PAR_canal.sauv
      on_event: restart_from_simple_checkpoint
      communicator: $nodeComm
      read:
        vitesse:
          dataset: vitesse
          dataset_selection:
            size: [1, '$dim_vitesse[0]', '$dim_vitesse[1]']
            start: ['$nodeRk', 0, 0]
        pression:
          dataset: pression
          dataset_selection:
            size: [1, '$dim_pression[0]', '$dim_pression[1]']
            start: ['$nodeRk', 0, 0]