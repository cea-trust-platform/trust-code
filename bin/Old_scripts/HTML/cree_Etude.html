#!/bin/bash
# Creation de la page html etude avec $debug=1 si developpement
# traduction des libelles en anglais le 12/03/98
debug=0
if [ ${#1} != 0 ]
then
   debug=$1
fi
ETUDE_TRUST=`QUELLE_ETUDE.ihm`
export ETUDE_TRUST
NOMETUDE=`echo $ECHO_OPTS $ETUDE_TRUST | $TRUST_Awk '{n=split($0,a,"/");print a[n]}'`

if [ ! -f $ETUDE_TRUST/.NOM_DATA ]
then
   echo $ECHO_OPTS $NOMETUDE > $ETUDE_TRUST/.NOM_DATA
fi
NOMCAS=`cat $ETUDE_TRUST/.NOM_DATA`
PORT=`cat $TRUST_TMP/.PORT`
LISTEDATA="<a href="$ETUDE_TRUST/.NOM_DATA">$NOMCAS.data</a> <a href=http://localhost:"$PORT"/Affiche.cg?"NOM_DATA">$NOMCAS.html</a>"

#Reflechir pour plus tard :
#LISTEDATA="Fichier "
#for fic in $ETUDE_TRUST/*.data
#do
#   LISTEDATA=$LISTEDATA" <a href="$fic">"`basename $fic`"</a>"
#done

# Decompression du fichier :
fichier=$HOME/.Etude.html
FIN="echo $ECHO_OPTS '\nPress return.';read OK;exit"
# Ecriture du fichier :
echo $ECHO_OPTS "<!--NewPage-->
<html>
<head>
<title> TRUST </title>
</head>
<body>" > $fichier
cree_en_tete.ihm >> $fichier
fichierref=$TRUST_ROOT/tests/References.html
[ "$DIPHA_ROOT" != "" ] && fichierref=$HOME/HTML/References.html
GMSH=`ls -rt $TRUST_ROOT/Outils/Gmsh/gmsh-*/bin/gmsh 2>/dev/null`
GMSH_ROOT=`dirname $GMSH`/..
echo $ECHO_OPTS "
<SCRIPT LANGUAGE="JavaScript">
function viewer(url)
{
var aff=window.open
(url,'aff','location=yes,toolbar=yes,directories=no,menubar=yes,resizable=yes,scrollbars=yes,status=yes,width=500,height=500');
aff.focus();
}
</SCRIPT>
<PRE><HR><h1>		STUDY $NOMETUDE </h1><HR>
To copy in your study <a href=$fichierref >a data file</a> from tests database. Look here for <a href=$TRUST_ROOT/IHM/Milieux.html>some</a> or <a
href=http://webbook.nist.gov/chemistry/fluid/>complete</a> datas for fluid characteristics

To copy in your study a Castem format file <a href=$TRUST_ROOT/IHM/Maillages_VEF.html>VEF mesh</a>
<HR><FORM METHOD="Change" ACTION="$TRUST_ROOT/form/Case.ksh?"><input type="submit" value="Change"> Change default data file $LISTEDATA</FORM><FORM METHOD="Edit" ACTION="$TRUST_ROOT/form/Editer.ksh?"><input type="submit" value="Edit">     Edit a file</FORM><FORM METHOD="EditData" ACTION="$TRUST_ROOT/form/Editer_xdata.ksh?"><input type="submit" value="EditData"> Edit the default data file with Xdata</FORM><FORM METHOD="Prepro" ACTION="$TRUST_ROOT/form/Xprepro.ksh"><input type="submit" value="Mesh">   Stuctured mesh generation with Xprepro</FORM><FORM METHOD="Gmsh" ACTION="$TRUST_ROOT/form/Gmsh.ksh"><input type="submit" value="Mesh">   Unstructured mesh generation with <A HREF=javascript:viewer(\"http://www.geuz.org/gmsh\")>Gmsh</A>\c" >> $fichier
[ "$GMSH_ROOT" != "" ] && echo $ECHO_OPTS ". See <A HREF=javascript:viewer(\"file:$GMSH_ROOT/share/doc/gmsh/tutorial\")>tutorials</A> or <A HREF=javascript:viewer(\"file:$GMSH_ROOT/share/doc/gmsh/demos\")>examples</A>.</FORM>\c" >> $fichier
echo $ECHO_OPTS "<FORM METHOD="Mesh" ACTION="$TRUST_ROOT/form/Mailler.ksh?"><input type="submit" value="Mesh">   Unstructured mesh generation with Castem <a href=$ETUDE_TRUST/.Liste.geom.html>See created meshes characteristics</a></FORM><FORM METHOD="Check" ACTION="$TRUST_ROOT/form/Check.ksh?"><input type="submit" value="Check">  Visualize the mesh</FORM><FORM METHOD="Ansys" ACTION="$TRUST_ROOT/form/preray.ksh"><input type="submit" value="Preray"> Define view factors for thermal radiation</FORM><HR><FORM METHOD="Solve" ACTION="$TRUST_ROOT/form/Calculer.ksh?"><input type="submit" value="Solve">  Run solve process <a href=$ETUDE_TRUST/.Liste.son.html>See results evolution</a></FORM>\c" >> $fichier

# Au cas ou on a lance depuis la partie developpement :
echo $ECHO_OPTS "<FORM METHOD="Stop" ACTION="$TRUST_ROOT/form/Stopper.ksh?"><input type="submit" value="Stop">   Stop solve process </FORM><FORM METHOD="Resume" ACTION="$TRUST_ROOT/form/Reprise.ksh?"><input type="submit" value="Resume"> Resume solve process</FORM><HR>\c" >> $fichier

EXEC_TRUST=`cat $TRUST_TMP/.EXEC_TRUST`
echo $ECHO_OPTS "\nExecutable used for this study:"
echo $ECHO_OPTS "----------------------------------------"
echo $ECHO_OPTS $EXEC_TRUST
echo $ECHO_OPTS "----------------------------------------"

echo $ECHO_OPTS "<FORM METHOD="xterm" ACTION="$TRUST_ROOT/form/Term.ksh?"><input type="submit" value="Terminal"> Open a window into the study</FORM><FORM METHOD="Change" ACTION="$TRUST_ROOT/form/Changer_exec.ksh?"><input type="submit" value="Change" onClick=\"file='file:$TRUST_TMP/change.html';win='win2',par='location=no,resizable=yes,scrollbars=yes,width=500,height=300' ; setTimeout('window.open(file,win,par)',100)\"> Change executable file</FORM><FORM METHOD="Test" ACTION="$TRUST_ROOT/form/update.ksh?"><input type="submit" value="Update">  Update TRUST binary since ftp.cea.fr</FORM><HR></body></html> " >> $fichier
cree_Liste.son.html
touch $ETUDE_TRUST/gnuplot/$NOMCAS.sous_menu1 $ETUDE_TRUST/gnuplot/$NOMCAS.sous_menu2
cree_Liste.conv.html "ReOpen the process windows"
cree_Liste.flux.html "ReOpen the process windows"
