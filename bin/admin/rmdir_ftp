#!/bin/bash 
ls_directory()
{
   $TRUST_ROOT/bin/admin/ls_ftp $1 | $TRUST_Awk -v root=$1 '(substr($1,1,1)=="d") {print root"/"$NF}'
}
find_directory()
{
   reps=`ls_directory $1`
   for rep in $reps
   do
      echo $rep
      find_directory $rep
   done
}

dir=`dirname $1`
rep=`basename $1`

# mdelete fait coredump sur ftp.cea.fr donc on contourne en listant les repertoires:

repertoires=`find_directory $1`" "$1
for repertoire in $repertoires
do
   echo "Efface $repertoire sur $TRUST_FTP"

   cat << ! | ftp -iv 2>&1 | $TRUST_Awk '/MKD command/ || /File exists/ || /failed/ {print $0}'
open $TRUST_FTP
cd ../..
cd $repertoire
mdelete *
mdelete .*
cd ..
rmdir `basename $repertoire`
!

done

