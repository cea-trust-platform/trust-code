%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Beamer Presentation
% LaTeX Template
% Version 1.0 (10/11/12)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%    PACKAGES AND THEMES
%----------------------------------------------------------------------------------------

%%TO COMPILE AND GENERATE THE INDEX
%pdflatex TRUST_tutorial.tex
%makeindex TRUST_tutorial.idx
%pdflatex TRUST_tutorial.tex
%pdflatex TRUST_tutorial.tex

\documentclass[10pt, hyperref={unicode=true,pdfusetitle, bookmarks=true,bookmarksnumbered=false,bookmarksopen=false, breaklinks=false,pdfborder={0 0 1},backref=true,colorlinks=true,linkcolor=darkblue,pageanchor}]{beamer}

\mode<presentation> {

% The Beamer class comes with a number of default slide themes
% which change the colors and layouts of slides. Below this is a list
% of all the themes, uncomment each in turn to see what they look like.

%\usetheme{default}
%\usetheme{AnnArbor}
%\usetheme{Antibes}
%\usetheme{Bergen}
%\usetheme{Berkeley}
%\usetheme{Berlin}
%\usetheme{Boadilla}
\usetheme{CambridgeUS}
%\usetheme{Copenhagen}
%\usetheme{Darmstadt}
%\usetheme{Dresden}
%\usetheme{Frankfurt}
%\usetheme{Goettingen}
%\usetheme{Hannover}
%\usetheme{Ilmenau}
%\usetheme{JuanLesPins}
%\usetheme{Luebeck}
%\usetheme{Madrid}
%\usetheme{Malmoe}
%\usetheme{Marburg}
%\usetheme{Montpellier}
%\usetheme{PaloAlto}
%\usetheme{Pittsburgh}
%\usetheme{Rochester}
%\usetheme{Singapore}
%\usetheme{Szeged}
%\usetheme{Warsaw}

% As well as themes, the Beamer class has a number of color themes
% for any slide theme. Uncomment each of these in turn to see how it
% changes the colors of your current slide theme.

%\usecolortheme{albatross} % bleubleu
%\usecolortheme{beaver} % rouge
%\usecolortheme{beetle} % bleu/gris
%\usecolortheme{crane}  % jaune
%\usecolortheme{dolphin} % bleu
%\usecolortheme{dove}  % blanc
%\usecolortheme{fly} % gris
%\usecolortheme{lily} % bleu
%\usecolortheme{orchid} % bleu
%\usecolortheme{rose} % bleu
%\usecolortheme{seagull} % gris
%\usecolortheme{seahorse} % bleu pale
%\usecolortheme{whale} % bleu
%\usecolortheme{wolverine} % jaune/bleu

%\setbeamertemplate{footline} % To remove the footer line in all slides uncomment this line
%\setbeamertemplate{footline}[page number] % To replace the footer line in all slides with a simple slide count uncomment this line

%\setbeamertemplate{navigation symbols}{} % To remove the navigation symbols from the bottom of all slides uncomment this line

}

\usepackage{graphicx} % Allows including images
%\usepackage{booktabs} % Allows the use of \toprule, \midrule and \bottomrule in tables
%\usepackage{multimedia} % for video
\definecolor{darkblue}{HTML}{3535B4}

\usepackage{multirow}
\usepackage{multicol}
\usepackage{makeidx}
    \makeindex


\newenvironment{theindex}
 {\let\item\par
  %definitions for subitem etc
  }{}
\newcommand\indexspace{}

%----------------------------------------------------------------------------------------
%    TITLE PAGE
%----------------------------------------------------------------------------------------
%\title[Short title]{Long title}
\title[TRUST tutorial v1.7.4]{TRUST tutorial v1.7.4} % The short title appears at the bottom of every slide, the full title is only on the title page

%\author{John Smith} % Your name
\institute[CEA/DEN/DANS/DM2S/STMF] % Your institution as it will appear on the bottom of every slide, may be shorthand to save space
{
CEA Saclay \\ % Your institution for the title page
\medskip
\textit{triou@cea.fr} % Your email address
\medskip
}
\date{\today} % Date, can be changed to a custom date


\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\titlepage % Print the title page as the first slide
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Overview} % Table of contents slide, comment this block out to remove it
%\tableofcontents[sectionstyle=show/show,subsectionstyle=hide/hide/hide ] 
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7}, hideallsubsections]
\column{.5\textwidth} 
\tableofcontents[sections={8-14}, hideallsubsections]
\end{columns}
% Throughout your presentation, if you choose to use \section{} and \subsection{} commands, these will automatically be printed on this slide as an overview of your presentation
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%    PRESENTATION SLIDES
%----------------------------------------------------------------------------------------

\section{{\bf{Initialization}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Initialization}
\begin{block}{}

\begin{itemize}
\item First, initialize the TRUST environment. On CEA Saclay PCs and callisto cluster, TRUST versions are available with (e.g. X.Y.Z=1.7.4):\\
\vspace{0.2cm}
\textbf{source  /home/triou/env\_TRUST\_X.Y.Z.sh}
\vspace{0.5cm}

\item Second, several editors (vim, emacs, nedit) can be configured to highlight TRUST keywords in the data files. If you prefer using \textbf{nedit}, please do the following:

    \begin{itemize}
    \item [$\circ$] Run \textbf{nedit}, and select Preferences $\rightarrow$ Save Defaults.
    \item [$\circ$] Then run \textbf{trust -config\index{trust -config} nedit}, the message "nedit.rc updated" should appear.
    \end{itemize}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\section{{\bf{Obstacle VDF}}} \label{exo1}
\subsection{Obstacle: Sequential calculation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Geometry}
\begin{block}{}

\begin{figure}
\includegraphics[width=1\textwidth]{PICTURES/Obstacle.pdf}
%\caption{Obstacle}
\end{figure}

\begin{itemize}
\item Fluid: $\mu=3.7 \, 10^{-5} kg.m^{-1}.s^{-1}$, $\rho=2 kg.m^{-3}$ and $R_e=\frac{U_0 H_{inlet} \rho}{\mu} = \frac{1 \times 0.22 \times 2}{3.7 \;10^{-5}} = 11 891$
\item Boundary conditions:\\
    \begin{itemize}
    \item [$\circ$] Inlet with fixed velocity: $U_0=1 m.s^{-1}$
    \item [$\circ$] Outlet with a fixed pressure: $P_0=0$
    \item [$\circ$] Square cylinder: Wall
    \item [$\circ$] Upper and Lower walls: Symmetry
    \end{itemize}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Create a study}
\begin{block}{}

\begin{itemize}
\item First, you must have already done the commands of the first section.
\vspace{0.2cm}

\item Open a terminal and run the commands to create a directory for your studies: \\
\textbf{mkdir -p \; $\sim$/test/yourname}\\
\textbf{cd \; $\sim$/test/yourname}
\vspace{0.2cm}

\item \label{method_copy} Copy a test case from the TRUST database to your study with the command:\\
\textbf{trust -copy\index{trust -copy} Obstacle}\\
\textbf{cd Obstacle}
\vspace{0.2cm}

\item Run the test case with the command:\\
\textbf{trust Obstacle}\\
\vspace{0.2cm}

\item Edit there the data file Obstacle.data and change some lines in order to modify the time step to 0.004s:\\
\textbf{nedit Obstacle.data \&}\\
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Probes and parameters}
\begin{block}{}

\begin{itemize}
\item Add to the post processing block of Obstacle.data the following elements :\\

    \begin{itemize}
    \item [$\circ$] A segment of pressure probes between the points (0.01, 0.12) and (0.91, 0.12).
    \vspace{0.1cm}

    \item [$\circ$] A segment of velocity probes between the points (0.92, 0.00) and (0.92, 0.22) to see the velocity profile behind the square cylinder.
    \vspace{0.1cm}

    \item [$\circ$] Add the vorticity to the fields being post processed and change the writing period to 0.5s. To find the keyword for this field, you can open the Generic Guide with:\\
    \textbf{trust -doc \&\index{trust -doc \&}}
    \vspace{0.1cm}

    \item [$\circ$] Add the keyword "\textbf{format lata\index{format lata}}" inside the block, just before the keyword \textbf{fields} in order to use the post processing tool VisIt during and/or after the calculation.
    \vspace{0.1cm}

    \item [$\rightarrow$] You have access to useful resources in the \$TRUST\_ROOT/index.html file with your favourite browser (eg: firefox). Take few minutes to find test case examples containing a particular keyword thanks to the \underline{Keywords} link: \\
    \textbf{firefox \$TRUST\_ROOT/index.html \&} \\
    or \textbf{trust -index \&\index{trust -index \&}}\\
    \end{itemize}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Visualization during the calculation}
\begin{block}{}

\begin{itemize}

\item Launch the tool "PLOT2D" to compute calculation and visualize results with: \\
\textbf{trust -evol\index{trust -evol} Obstacle \&}

\item To run the calculation, click on the button "Start computation!" at the bottom left corner of the window.

\item Visualization:
    \begin{itemize}
    \item [$\circ$] Select "PRESSION(X=0.13,Y=0.105)" in the left list to see the evolution of your pressure probe and click behind on "Plot".
    \item [$\circ$] Check the velocity profile behind the square cylinder with "VITESSE\_X(X=0.14,Y=0.115)" and "VITESSE\_Y(X=0.14,Y=0.115)".
    \item [$\circ$] Visualize the equation residuals on the same plot, select "$ Ri = max \left| \frac{dV}{dt} \right|$" and "$residu = max \left| Ri \right|$" using the button "Plot on same" or select the two graphs with "Ctrl" button and "plot".
    \end{itemize}
\vspace{0.1cm}

%\item Check the convergence monitoring: plot 0 in the first menu to open the convergence menu, then open the 4 following plots:
%    \begin{itemize}
%    \item [$\circ$] Pressure linear system convergence at each time step
%    \item [$\circ$] Residual error $\left\Vert Ax-B \right\Vert$ of the pressure linear system at the last time step
%    \item [$\circ$] Time step evolution
%    \item [$\circ$] Flow rate error evolution
%    \end{itemize}
%Type "5" to quit this menu and return to the first one.
%\vspace{0.1cm}
%\item Open the menu "Surface fluxes characteristics" (plot1), visualize:
 %   \begin{itemize}
 %   \item [$\circ$] the drag exerted by the fluid on the square Cylinder (plot 1, then 4 for the square), close this menu with 7.
%    \item [$\circ$] the "Pressure drag + Friction drag" with 5 and select the Square boundary (4). Each drag is plotted together with the total drag also called viscous drag.
%    \end{itemize} 

\item To quit this tool, close the GUI.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{VisIt}
\begin{block}{}

\begin{itemize}
\item Once the calculation is finished, visualize the results with the graphical tool VisIt directly: \textbf{visit\index{visit} \&} \\
or using "PLOT2D" tool: \textbf{trust -evol\index{trust -evol} Obstacle \&} and click on "Visualisation" on the right menu.

    \begin{itemize}
    \item [$\circ$] First, we are going to configure VisIt: {\footnotesize{In the menu File $\rightarrow$ Open file, select Off instead of Smart for File grouping option. For the Filter, specify *.lata to list only the LATA results file. Then save your choices, in the menu Options $\rightarrow$ Save Settings.}}

    \item [$\circ$] In the menu File $\rightarrow$ Open file, select the Obstacle.lata file.

    \item [$\circ$] Visualize the mesh in the "Plots" area with "Add $\rightarrow$ Mesh $\rightarrow$ dom" then click on the button "Draw". Zoom and move the mesh in the right window. You will un-zoom with right button (View $\rightarrow$ Reset view) or with a combination of CTRL keypad and left button.

    \item [$\circ$] Visualize the pressure field ({\footnotesize{Plots area: "Add $\rightarrow$ Pseudocolor $\rightarrow$ PRESSION\_SOM\_dom" + Draw then select the last time on the Time slider}})
    \item [$\circ$] Suppress or hide the mesh (Select Mesh then click on Delete or Hide/Show).
    \end{itemize}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{VisIt}
\begin{block}{}

\hspace{1cm} $\color{darkblue}\circ$ {\small{Visualize the velocity field ({\footnotesize{Plots area: "Add $\rightarrow$ Vector $\rightarrow$ VITESSE\_SOM\_dom"}}\\
\hspace{1.3cm} {\footnotesize{ + Draw)}}. You can change each plot attributes:}}\\
\vspace{0.05cm}
\hspace{1.5cm} $\color{darkblue}\diamond$ {\footnotesize{click once onto the small arrow "$\blacktriangleright$" then }}\\
\hspace{1.5cm} $\color{darkblue}\diamond$ {\footnotesize{double click on the item Vector (cf the figure below). For example, change \\
\hspace{1.8cm} the amount of vectors plotted (by default 400, increase this number to 40000 \\
\hspace{1.8cm} then click the button "Make default" and save definitively this change with \\
\hspace{1.8cm} the menu Options $\rightarrow$ Save Settings). You need to click Apply to update. Then \\
\hspace{1.8cm} click "Dismiss" to close the window.}}\\

\begin{figure}
\includegraphics[width=0.45\textwidth]{PICTURES/visit3.jpg}
%\caption{Obstacle}
\end{figure}

\hspace{1cm} $\color{darkblue}\circ$ {\small{Print your visualization (File $\rightarrow$ Save window): a PNG file is created into your \\
\hspace{1.3cm} study directory.}}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{VisIt}
\begin{block}{}

\hspace{1cm} $\color{darkblue}\circ$ {\small{Add a second screen with "Windows $\rightarrow$ Layouts $\rightarrow$ 1x2",}}\\

\hspace{1cm} $\color{darkblue}\circ$ {\small{Plot a pressure horizontal profile:\\}}
\hspace{1.5cm} $\color{darkblue}\diamond$ {\footnotesize{ select the pressure field and thanks to the right button,}} \\ 
\hspace{1.5cm} $\color{darkblue}\diamond$ {\footnotesize{ select "Mode $\rightarrow$ Line out", and define your profile with left button,}} \\
\hspace{1.5cm} $\color{darkblue}\diamond$ {\footnotesize{ click on the origin point, let the left button pushed, and release at the end point.}}\\
\hspace{1.5cm} $\color{darkblue}\diamond$ {\footnotesize{ The profile is shown on the second window.}}\\

\hspace{1cm} $\color{darkblue}\circ$ {\small{You notice that it is necessary to update (button Draw) the right window after \\
\hspace{1.3cm} adding a new plot or changing an option. It is possible to automatically \\
\hspace{1.3cm} update by activating "Auto apply" on the top right of the VisIt's GUI.}}\\

\hspace{1cm} $\color{darkblue}\circ$ {\small{You can create create new fields (expression) with "Controls $\rightarrow$ Expressions \\
\hspace{1.3cm} $\rightarrow$ New" by using existing variables and complex functions and visualize it.}}\\

\hspace{1cm} $\color{darkblue}\circ$ {\small{You can animate your visualization and/or create a movie (File $\rightarrow$ Save movie)}}\\

\hspace{1cm} $\color{darkblue}\circ$ {\small{You can operate calculations on variables with complex queries \\
\hspace{1.3cm} (Controls $\rightarrow$ Query),}}\\

\hspace{1cm} $\color{darkblue}\circ$ {\small{You can save a complex session (File $\rightarrow$ Save session) and reopen it during a \\
\hspace{1.3cm} next analyze with VisIt (File $\rightarrow$ Restore session),}}



\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Outputs and "reprise"}
\begin{block}{}

\hspace{1cm} $\color{darkblue}\circ$ {\small{During a 3D visualization, you will use one of the available Operators \\
\hspace{1.3cm} (In Plots, "Operators $\rightarrow$ Slicing $\rightarrow$ Slice") to create a 2D slice either in a 3D \\
\hspace{1.3cm} space, or projected to a 2D space.}}

\begin{itemize}
\item Edit the different output (*.out) files to read the complete balances (mass, stress, energy, ...) on the whole domain or at the boundaries.

\item Now we want to change the data file to restart the calculation. So open it using "PLOT2D" tool: \textbf{trust -evol\index{trust -evol} Obstacle \&}.

\item Find the last backup time of the previous calculation in the .err file (or in the bottom right file in the "PLOT2D" tool, if you didn't close it since the beginning of this practice).

\item \label{save_restart} Edit your data file, with "Edit data" or "Edit with xdata" and modify \textbf{tinit\index{tinit}}, \textbf{tmax\index{tmax}} values in the object "mon\_schema" and add in the problem definition just before the last "\}":\\
\textbf{reprise binaire\index{reprise binaire} Obstacle\_pb.sauv}\\
(The file "Obstacle\_pb.sauv" must have been created during the first run.)
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Outputs and "reprise"}
\begin{block}{}

\begin{itemize}
\item Save and close the window.

\item Restart the calculation again with "Start calculation!" button. You can see that values are added to the first probes during the new calculation.

\item [$\color{green}\Rightarrow$] \textit{Remark :} to restart your calculation, you can also use the keyword \textbf{resume\_last\_time\index{resume\_last\_time}} instead of \textbf{reprise} and only change the \textbf{tmax\index{tmax}} value (cf Reference Guide).
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\subsection{Obstacle: Parallel calculation} \label{exo_para_1}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Parallel calculation: method 1}
\begin{block}{}

The goal of this exercise is to introduce parallelism in the data file of the previous exercise.

\begin{itemize}
\item Go to the previous study (should be done) and after you had suppressed the \textbf{reprise} keyword and set \textbf{tinit\index{tinit}} to 0 again in the \textit{Obstacle.data} file, create the two new files:\\
\textbf{cd $\sim$/test/yourname/Obstacle} \\
\textbf{mkdir PARA1} \\
\textbf{cd PARA1} \\
\textbf{cp ../Obstacle.data DEC\_Obstacle.data} \\
\textbf{cp ../Obstacle.data PAR\_Obstacle.data} \\
\textbf{cp ../Obstacle.geo .}\\
\vspace{0.3cm}
\item Edit the first file (\textit{DEC\_Obstacle.data}) to create the partition of the mesh.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Parallel calculation: method 1}
\begin{block}{}

\begin{itemize}
\item In this file, uncomment the block around the \textbf{Partition} keyword.
    \begin{itemize}
    \item [$\circ$] Here, the partitioning tool \textbf{Metis\index{Metis}} is used. We cut in \textbf{nb\_parts\index{nb\_parts}} blocks, here in 2.
    \item [$\circ$] The overlapping width \textbf{Larg\_joint\index{Larg\_joint}} between two parts of the partition should be defined according to the numerical scheme higher order, generally the convective scheme. Its value is generally 1 for the two order scheme, and 2 for the three or four-order scheme like Quick\index{quick} scheme.
    \item [$\circ$] In VEF, you should use \textbf{2} for \textbf{Larg\_joint\index{Larg\_joint}} except when partitioning a domain where only the conduction equation will be solved.
    \item [$\circ$] At least, the keyword \textbf{zones\_name\index{zones\_name}} is useful to define the name of the files containing the partitioned mesh and to write these files.
    \item [$\circ$] Notice the presence of the keyword \textbf{End} in the "Partition" block: the code will stop to read the data file at this point!
    \end{itemize}

\item Run the data file: \textbf{trust DEC\_Obstacle}

\item Check the partitioned mesh files DOM\_0000.Zones and DOM\_0001.Zones are generated in your directory: \textbf{ls *.Zones}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Parallel calculation: method 1}
\begin{block}{}

\begin{itemize}
\item Now, edit the file PAR\_Obstacle.data and comment the read of the mesh
(\textbf{Read\_file}) and uncomment the \textbf{Scatter} keyword which will read the partitioned
mesh. Visualize it with VisIt:\\
\textbf{trust -mesh\index{trust -mesh} PAR\_Obstacle}

\item Now, run a parallel calculation with TRUST:\\
\textbf{trust PAR\_Obstacle 2}

\item The post-processing task is identical in sequential or parallel mode. You have the
probes into the .son files and the whole fields in the .lata files. To run VisIt with the
command line:\\
\textbf{visit\index{visit} -o PAR\_Obstacle.lata \&}

\item Select the last time step and visualize the blocks (with Plots: Add $\rightarrow$ Subset $\rightarrow$ blocks)
which represent the parts of the domain partition, then the velocity fields. You can
also visualize a field only on a selected part (block) with the menu Control $\rightarrow$ Subset.

\item To visualize probes after the end of the calculation, you can run the command line:\\
\textbf{trust -evol\index{trust -evol} PAR\_Obstacle \&}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Parallel calculation: method 2} \label{exo_para_2}
\begin{block}{}

\begin{itemize}
\item The existing tool \textbf{make\_PAR.data\index{make\_PAR.data}} is useful on the data files \underline{which have} the marks MAILLAGE/MESH, DECOUPAGE/PARTITION and LECTURE/SCATTER. If you run the following commands: \\
\vspace{0.2cm}

\item First we will create a new working directory with our data files:\\
\textbf{cd $\sim$/test/yourname/Obstacle} \\
\textbf{mkdir PARA2} \\
\textbf{cd PARA2} \\
\textbf{cp ../Obstacle.data exemple.data}\\
\textbf{cp ../Obstacle.geo .}\\
\vspace{0.2cm}

\item Then we can run the command:\\
\textbf{make\_PAR.data\index{make\_PAR.data} exemple 3}\\
\textbf{ls}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Parallel calculation: method 2}
\begin{block}{}

\begin{itemize}
\item It creates:
    \begin{itemize} 
    \item [$\circ$] a \underline{SEQ\_exemple.data} file which is a copy of the sequential data file exemple.data,
    \item [$\circ$] a \underline{DEC\_exemple.data} file which is the first data file to be run. It is immediately run by the command line \textbf{make\_PAR.data} to create a partition (with 3 sub zones here), located in the ***.Zones files. \\
    \textbf{ls *.Zones}\\
    Note that the code stops reading this file at the keyword "End" just before the "\# END PARTITION \#" block.
    \item [$\circ$] a \underline{PAR\_exemple.data} file which is the data file for the parallel calculation. It uses the ***.Zones files to read the mesh through the line "Scatter DOM.Zones dom". Note that the meshing and cut of the mesh are commented here.
    \end{itemize}

\item Then you have to run the calculation by the usual command completed by the number of processors needed:\\
\textbf{trust PAR\_exemple 3}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Parallel calculation: method 2}
\begin{block}{Useful informations:}

\begin{itemize}
\item Be careful when you want to modify you data file! You have two possibilities:
    \begin{itemize} 
    \item [$\circ$] you want to modify your mesh,
    \item [$\circ$] you want to modify the calculation parameters.
    \end{itemize}

\item For the first one, you can modify:
    \begin{itemize} 
    \item [$\circ$] the file exemple.data and run \textbf{make\_PAR.data}. But it will \underline{erase} the DEC\_exemple.data, SEQ\_exemple.data and PAR\_exemple.data files and create new zones. Then it will run the new DEC\_exemple.data file which gives your new ***.Zones files \underline{or},
    \item [$\circ$] the meshing part of file DEC\_exemple.data and run it with:\\
    \textbf{trust DEC\_exemple.data} \\
    \end{itemize}
Then run the parallel calculation normally, on the new ***.Zones files.\\
\textbf{trust PAR\_exemple 3}

\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Parallel calculation: method 2}
\begin{block}{}

\begin{itemize}
\item For the second possibility, you can modify:
    \begin{itemize} 
    \item [$\circ$] the file exemple.data and run \textbf{make\_PAR.data}. But it will \underline{erase} the DEC\_exemple.data, SEQ\_exemple.data and PAR\_exemple.data files and create new ones. Then it will run the new DEC\_exemple.data file. \underline{Note that in that} \underline{case, you don't need to re-create the mesh so you can use the second point} \underline{below:}
    \item [$\circ$] modify the PAR\_exemple.data file \underline{without} running \textbf{make\_PAR.data}.
    \end{itemize}
Then run the PAR\_exemple.data file with:\\
\textbf{trust PAR\_exemple 3}

\item \underline{Notice that if after a certain time, you want to reopen an old case} and understand want you did in it without any doubts, you may create two files by your hands:
    \begin{itemize} 
    \item [$\circ$] one "BuildMeshes.data" file only for the mesh and the cut of the mesh, and
    \item [$\circ$] one "calculation.data" file for the parallel calculation. 
    \end{itemize}
You will run it like:\\
\textbf{trust BuildMeshes}\\
\textbf{trust calculation nb\_procs}\\
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\subsection{Obstacle: Parallel calculation on a cluster} \label{exo_para_3}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Parallel calculation on a cluster}
\begin{block}{}

\begin{itemize}
\item Log on to the cluster callisto and initialize the TRUT version: \\
\vspace{0.2cm}
{\small{
\textbf{ssh -X yourlogin@callisto-login1(.intra.cea.fr)} \\
\textbf{source /panfs/ixion/home/triou/TRUST/TRUST\_X.Y.Z/env\_TRUST.sh}\\
or 
\textbf{source /home/triou/env\_TRUST\_X.Y.Z.sh}\\
}}
\vspace{0.2cm}

\item Copy the study Obstacle:\\
\vspace{0.2cm}
\textbf{cd /panfs/ixion/home/yourlogin}\\
\textbf{mkdir  -p  test/yourname} \\
\textbf{cd test/yourname} \\
\textbf{trust -copy\index{trust -copy} Obstacle} \\
\textbf{cd Obstacle} \\
\vspace{0.2cm}

\item Open Obstacle.data and add \textbf{"format lata\index{format lata}"} in the post-traitement block.
\vspace{0.2cm}

\item Create automatically a 2 partitioned mesh and a parallel datafile with:
\vspace{0.2cm}
\textbf{make\_PAR.data\index{make\_PAR.data} Obstacle}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Parallel calculation on a cluster}
\begin{block}{}

\begin{itemize}
\item Submit the parallel calculation on 2 cores:\\
\vspace{0.2cm}
\textbf{trust PAR\_Obstacle 2}
\vspace{0.2cm}

\item For clusters, you have to create a submission file:\\
\vspace{0.2cm}
\textbf{trust -create\_sub\_file\index{trust -create\_sub\_file} PAR\_Obstacle 2}
\vspace{0.2cm}

\item Open the file sub\_file and change the name of the job. Note that we will see only the first eight characters of the name of the job in the list of submitted jobs.
\vspace{0.2cm}

\item Submit the job with: \textbf{sbatch sub\_file}
\vspace{0.2cm}

\item Check the state of the job with: \textbf{"squeue"} or \textbf{"squeue -u yourlogin"}
\vspace{0.2cm}

\item You could run VisIt from the cluster but it is not recommended. But you can run VisIt on your PC and access/visualize the result file on callisto cluster, with File $\rightarrow$ Open File and select callisto in the localhost menu.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\section{{\bf{Heat exchange VDF/VEF}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Heat exchange VDF/VEF exercise}
\begin{block}{}


\begin{columns}[c] 
\column{.55\textwidth}
%\begin{figure}
\begin{center}
\includegraphics[width=1.\textwidth]{PICTURES/heat_exchange.pdf}
\end{center}
%\caption{Obstacle}
%\end{figure}

\column{.4\textwidth} 
$$
\begin{array}{ll}
\mbox{\textbf{Fluid:}}      & Pr=\frac{\mu C_p}{\lambda}=1, \\
%                            & Ra=20000,\\
                            & T_{ref}=30^o C,\\
                            & \mu=2 \; 10^{-3} kg.m^{-1}.s^{-1},\\
                            & \rho=2 \; kg.m^{-3},\\
                            & \lambda=1. W.m^{-1}.K^{-1} \\
                            & Cp=500 J.kg^{-1}.K^{-1},\\
                            & \beta=1.10^{-4} K^{-1} \\
                            &  \\
\mbox{\textbf{Solid:}}      & \rho=1000 kg.m^{-3} \\
                            & \lambda=250 W.m^{-1}.K^{-1} \\
                            & Cp=100 J.kg^{-1}.K^{-1}
\end{array}
$$

\end{columns}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Heat exchange VDF/VEF exercise}
\begin{block}{}

\begin{itemize}
\item Create a new study Coupling\_VDF by copying the docond study:\\
\textbf{cd $\sim$/test/yourname} \\
\textbf{trust -copy\index{trust -copy} docond} \\
\textbf{mv docond Coupling\_VDF} \\
\textbf{cd Coupling\_VDF} \\

\item Check the fluid and solid characteristics inside the docond.data file.

\item This coupled problem is constituted by 2 domains of calculation with a mesh of 10x10 cells ($\Delta x = \Delta y = 0.1m$) created with 3 blocks. 

\item Modify the data file to have the 2 domains on a mesh of 40x40 cells ($\Delta x= \Delta y=0.025m$). For this, open your data file with "Plot2D" tool:\\
\textbf{trust -evol\index{trust -evol} docond  \&} \\

\item Click on "Edit data" (you can also use "Edit with xdata").

\item Change the number of nodes for each block like this:\\
First block (Cavite1): 4 11 $\rightarrow$ 13 41 \\
Second block (Cavite2): 8 4 $\rightarrow$ 29 13 \\ 
Third block (Cavite3): 8 8  $\rightarrow$ 29 29 \\
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Heat exchange VDF/VEF exercise}
\begin{block}{}

\begin{itemize}
\item Change \textbf{"format lml\index{format lml}"} to \textbf{"format lata\index{format lata}"} into the two problems definition

\item Click on "Save" and close the window.

\item Run the calculation with "Start computation!" and check the evolution.

\item Then post process the temperature field with VisIt tool: "Visualization" button. A natural convection cell appears. Change the colour tables for the temperature to have the same one on the 2 domains. Close VisIt.

\item We are going to change the discretization of the test case. Triangulate the domains with the keyword \textbf{Trianguler\_H\index{Trianguler\_H}} (See the syntax in the Reference Guide). Give an unstructured aspect to the 2 meshes thanks to the following keyword : \\
\textbf{Transformer\index{Transformer} name\_of\_domain \; x*(1-0.5*y*y) \; y*(1+0.1*x*y)}

\item Substitute the discretization VDF\index{VDF} (pressure nodes at the element center) to VEFPreP1B\index{VEFPreP1B} (pressure nodes at the element center and nodes).

\item Close the Plot2D tool.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Heat exchange VDF/VEF exercise}
\begin{block}{}

\begin{itemize}
\item Check the meshes with: \\
\textbf{trust -mesh\index{trust -mesh} docond}

\item Run the calculation with:\\
\textbf{trust -evol\index{trust -evol} docond  \&}

\item Click : 'Start computation!', select 'Ri=max\_pb1$|dT/dt|$', 'Ri=max\_pb2$|dT/dt|$', 'Ri=max\_pb2$|dV/dt|$', 'residu=max$|Ri|$' with "Ctrl" button and click on 'Plot on same'.

\item To see when convergence is reached, select a probe (for example temperature) and click on 'Plot'. 

\item Post-process the results and compare with VDF\index{VDF} discretization about the CPU performance: the VEF calculation is running 10 times slower (cause higher number of pressure unknowns and smaller time steps). Study the docond.out file to see the time steps for each equation (click on "Edit .out" at the top right corner of the GUI).
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Heat exchange VDF/VEF exercise}
\begin{block}{}

\begin{itemize}
\item Accelerate the calculation by impliciting the diffusion operators of each equation with \textbf{diffusion\_implicite\index{diffusion\_implicite}} option in the explicit Euler scheme (check again the Generic Guide: \textbf{trust -doc \&\index{trust -doc \&}}). 

\item Run the calculation without any option: \\
\textbf{trust docond}

\item \label{schema_impl} Use a full implicit scheme now (suppress \textbf{diffusion\_implicite\index{diffusion\_implicite}}), by substituting \textbf{Scheme\_Euler\_Explicit} by \textbf{Scheme\_Euler\_implicit\index{scheme\_euler\_implicit}} and adding the \textbf{Implicite} solver. Have a look at the Reference Guide for the \textbf{gmres\index{gmres}} options and define accordingly to the advices given into the Reference Guide, a value for \textbf{facsec\index{facsec}, facsec\_max\index{facsec\_max}}. Your block will looks like:\\
\textbf{Solveur Implicite\index{Solveur Implicite} \{ solveur gmres\index{gmres} \{ diag seuil 1e-30 nb\_it\_max 5 impr \}  seuil\_convergence\_implicite\index{seuil\_convergence\_implicite} 0.01  \} }

\item Run the calculation:\\
\textbf{trust -evol\index{trust -evol} docond  \&}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\section{{\bf{Low mach number flow}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Low mach number flow}
\begin{block}{}

\begin{itemize}
\item Open a terminal and create a directory using Unix commands, and copy the study \textbf{TP\_Temp\_QC\_VEF} (it is a 2D simulation of helium gas flow from left to right between two heated walls):\\
\textbf{mkdir -p $\sim$/test/yourname}\\
\textbf{cd $\sim$/test/yourname}\\
\textbf{trust -copy\index{trust -copy} TP\_Temp\_QC\_VEF}\\
\textbf{cd TP\_Temp\_QC\_VEF}

\item Open the Generic Guide with (it will be useful to search for keywords in this exercice): \textbf{trust -doc \&\index{trust -doc \&}}

\item Edit the data file with your favorite editor (\textbf{nedit} is recommended because it is configured to recognize TRUST syntax):\\
\textbf{nedit TP\_Temp\_QC\_VEF.data \&} \\
or \\
\textbf{trust -evol\index{trust -evol} TP\_Temp\_QC\_VEF  \&} and "Edit data" button.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Low mach number flow}
\begin{block}{}

\begin{itemize}
\item Modify the data file in order to:
    \begin{itemize}
    \item [$\circ$] Change the geometry and the mesh:
    \begin{figure}
    \includegraphics[width=0.5\textwidth]{PICTURES/low_mach.pdf}
    %\caption{Obstacle}
    \end{figure}
    \item [$\circ$] Add several probes (velocity, volume mass, temperature) near the upper right corner of the geometry at location (x,y)=(4,1).
    \item [$\circ$] Add a probe \textbf{"segment"} (with 9 points) between the locations (x,y)=(4,0.05) and (x,y)=(4,0.95) for the temperature field.
    \item [$\circ$] Write the results with the \textbf{LATA} format and change the \textbf{dt\_post\index{dt\_post}} period to 1s.
    \item [$\circ$] We are looking for the stationary state, so suppress tmax\index{tmax} keyword and change the \textbf{seuil\_statio\index{seuil\_statio}} $\varepsilon$ value to 10 ($|dT/dt|<\varepsilon$ and $dt \sim 0.001s$ so $|dT|<0.01$).
    \item [$\circ$] Add the keyword \textbf{impr} into the pressure solver to print its convergence.
    \item [$\circ$] If you use Plot2D tool, save and close the editor.
    \end{itemize}

\item Run the simulation with the TRUST command (if not already done):\\
\textbf{trust -evol\index{trust -evol} TP\_Temp\_QC\_VEF \&} \\
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Low mach number flow}
\begin{block}{}

\begin{itemize}
\item Click on "Start computation!".
\item Check mass flow rate (absolute and relative values) in the TP\_Temp\_QC\_VEF.out file: \\
\textbf{nedit TP\_Temp\_QC\_VEF.out \&} \\
or look at the first window on the right of the PLOT2D tool.

\item Once the calculation finishes, visualize the results by running \textbf{VisIt}:\\
\textbf{visit\index{visit} -o TP\_Temp\_QC\_VEF.lata \&}\\
or \\
"Visualization" button on Plot2D tool.
\begin{itemize}
    \item [$\circ$] See the mesh (Plots: "Add $\rightarrow$ Mesh $\rightarrow$ dom $\rightarrow$ Draw").
    \item [$\circ$] Visualize the temperature field (Select the last Time with the slicer, then Plots: "Add $\rightarrow$ Pseudo Color $\rightarrow$ TEMPERATURE\_SOM\_dom  $\rightarrow$ Draw").
    \item [$\circ$] Suppress or hide the mesh (Select "Mesh-dom" in the list of plots then "Delete" or "Hide/Show").
    \item [$\circ$] Visualize the velocity field (Add $\rightarrow$ Vector $\rightarrow$ VITESSE\_SOM\_dom $\rightarrow$ Draw).
\end{itemize}

\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Low mach number flow}
\begin{block}{}

\hspace{1cm} $\color{darkblue}\circ$ {\small{Select the Zoom mode with the right button of the mouse (Mode $\rightarrow$ Zoom) \\
\hspace{1.3cm}  then zoom by selecting an area in the plot. To un-zoom push "Ctrl" button \\
\hspace{1.3cm}  and select an area with the left button or with the right button select \\
\hspace{1.3cm}  "View $\rightarrow$ Reset view".}}\\
\hspace{1cm} $\color{darkblue}\circ$ {\small{Print your visualization (File $\rightarrow$ Set Save options $\rightarrow$ File type $\rightarrow$ Select a type \\
\hspace{1.3cm}  $\rightarrow$ Save): a file named visit*** is created into your study directory.}}

\hspace{1cm} $\color{darkblue}\circ$ {\small{Add a second screen with "Window $\rightarrow$ Layout $\rightarrow$ 1x2".}}

\hspace{1cm} $\color{darkblue}\circ$ {\small{Plot a temperature horizontal profile (Select the temperature field and \\
\hspace{1.3cm} thanks to the right button, select "Mode $\rightarrow$ Lineout", and define your \\
\hspace{1.3cm} profile with left button): the profile is shown on the second window.}}

\begin{itemize}
\item Substitute the time scheme by an implicit time scheme (like \textbf{scheme\_euler\_implicit\index{scheme\_euler\_implicit}}). 

\item Use the \textbf{implicite} solver and specify \textbf{facsec\index{facsec}} and \textbf{facsec\_max\index{facsec\_max}} parameters according to the advices given into the Reference Guide (search for the \textbf{scheme\_euler\_implicit\index{scheme\_euler\_implicit}} keyword for the according syntax). You can also see the informations at the end of the Heat exchange VDF/VEF exercise at p.\pageref{schema_impl}.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Low mach number flow}
\begin{block}{}

\begin{itemize}
\item Run the calculation with this time scheme with the PLOT2D tool or: \\
{\footnotesize{\textbf{trust TP\_Temp\_QC\_VEF.data 1$>$TP\_Temp\_QC\_VEF.out 2$>$TP\_Temp\_QC\_VEF.err}}}

\item Edit the following file where is located information about dt the used time-step, dt\_stab the stability time-step, \textbf{facsec\index{facsec}} evolution (dt=dt\_stab*facsec) and residuals for each equation: \\
\textbf{nedit TP\_Temp\_QC\_VEF.dt\_ev \&}

\item  If everything is OK, try to fine tune the speed convergence of the implicit solver with the value of \textbf{seuil\_convergence\_implicite\index{seuil\_convergence\_implicite}} keyword (look inside the TP\_Temp\_QC\_VEF.out file and check that the number of iterations for GMRES\index{gmres} is between 3 and 5, it is enough to quickly converge).

\item  To restart a calculation, you will need to change the \textbf{tinit\index{tinit}} value into the data file (pick up the last save time in the \textbf{.err} file) and insert into the data file in the problem definition the following keywords: \\
\textbf{reprise binaire\index{reprise binaire} TP\_Temp\_QC\_VEF\_pb.sauv}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Low mach number flow}
\begin{block}{}

\begin{itemize}

\item  Then run the calculation with: \\
{\footnotesize{\textbf{trust TP\_Temp\_QC\_VEF.data 1$>$TP\_Temp\_QC\_VEF.out 2$>$TP\_Temp\_QC\_VEF.err}}} \\
or \\
\textbf{trust -evol\index{trust -evol} TP\_Temp\_QC\_VEF.data \&} which creates automatically the .out

\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\section{{\bf{Periodic 3D channel flow}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Periodic 3D channel flow}
\begin{block}{}

\begin{figure}
\includegraphics[width=0.45\textwidth]{PICTURES/periodic3D.png}
%\caption{Obstacle}
\end{figure}

\textbf{Fluid:} $Re=2000$, $\rho=2 kg.m^{-3}$, $\mu=0.01 kg.m^{-1}.s^{-1}$, initial velocity $V0=1m/s$, periodic boundary condition on Z direction.

\begin{itemize}
\item Copy the study named \textbf{P1toP1Bulle} like explained page \pageref{method_copy}. It simulates a 3D incompressible laminar flow ($Re=2000$) with periodic boundary according Z direction only.

\item Open the P1toP1Bulle.data file and use \textbf{RegroupeBord\index{RegroupeBord}} keyword to merge Entree and Sortie boundaries into a single one named periox. 
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Periodic 3D channel flow}
\begin{block}{}

\begin{itemize}
\item Change the boundary conditions to apply a periodic boundary on the new boundary. 

\item Change the velocity initial condition to $U_0=(1,0,0)$. 

\item Set the option \textbf{diffusion\_implicite\index{diffusion\_implicite}} to 1 into the Euler scheme to implicit the diffusive operator of the Navier Stokes equation.

\item You have now a 3D calculation with periodic condition on X and Z directions. Run the calculation on 30 time-steps (keyword \textbf{nb\_pas\_dt\_max\index{nb\_pas\_dt\_max}}).

\item Have a look at the P1toP1Bulle\_pb\_Debit.out file, check the flow rate on the periox boundary. Why does it decrease?

\item Add the \textbf{Canal\_perio} source term in the Navier Stokes equation of the data file and run again the calculation to check the flow rate evolution on 30 time steps. 

\item Look for the pressure and viscous forces applied to the cylinder inside the .out files.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Periodic 3D channel flow}
\begin{block}{}

\begin{itemize}
\item Now, the calculation domain is a rotating channel according to Z direction with a constant velocity $\Omega=1 rad/s$. 

\item Add the \textbf{Acceleration} source term in the Navier Stokes equation. Suppress the \textbf{nb\_pas\_dt\_max\index{nb\_pas\_dt\_max}} keyword and set \textbf{tmax\index{tmax}} to 100s.

\item Add, if you wish, velocity or statistic calculation in the post processing instructions. 

\item Run the calculation.

\item You can create a uniformly refined mesh using for instance the keyword \textbf{Raffiner\_Anisotrope\index{Raffiner\_Anisotrope}}.

\item Then improve the calculation speed on this mesh, you could try to use a coarse discretization \textbf{P1} (\textbf{Read dis \{ P1 \}} keywords) with less pressure unknowns. On this mesh, it runs 3 times faster than P1Bulle but with less accuracy: 8452 unknowns compare to 49221 unknowns.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Periodic 3D channel flow}
\begin{block}{}

\begin{itemize}
\item Then restart the calculation with \textbf{VEFPreP1B\index{VEFPreP1B}} discretization by reading the velocity field with \textbf{Champ\_fonc\_reprise\index{Champ\_fonc\_reprise}} keyword in the initial conditions for the velocity:\\
\textbf{vitesse champ\_fonc\_reprise\index{Champ\_fonc\_reprise} P1toP1Bulle\_pb.xyz  pb  vitesse  last\_time} \\
\underline{This will be useful to reach the quasi-stationary state faster.}

\item You can also use implicit scheme (change the scheme to \textbf{Scheme\_Euler\_implicit\index{scheme\_euler\_implicit}} scheme and use an \textbf{Implicite} solver) \underline{only if you are looking for the stationary state}.\\ 
You can also see the informations at the end of the Heat exchange VDF/VEF exercise page \pageref{schema_impl}.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{{\bf{Constituents and turbulent flow}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Constituents and turbulent flow}
\begin{block}{}

\begin{figure}
\includegraphics[width=0.75\textwidth]{PICTURES/marche.pdf}
%\caption{Obstacle}
\end{figure}

\textbf{Fluid:} $\mu=3.7 \, 10^{-5} kg.m^{-1}.s^{-1}, \rho=2 \, kg.m^{-3}, R_e=\frac{U_0 H_{inlet} \rho}{\mu} =54054$

\textbf{Boundary conditions:} \\
Inlet with fixed velocity: $U_0=1 m.s^{-1}$, C1\_eps=$10^{-2}$, C2\_eps=$10^{-3}$ (dimensionless values)\\
Outlet with a fixed pressure: $P_0=0$, C1\_eps=0, C2\_eps=0 \\
Upper and lower walls: No slip wall ($U=0$) and non-porous wall ($\partial C_i/\partial n=0$)

\begin{itemize}
\item Copy the study named \textbf{Marche} like explained page \pageref{method_copy}. It simulates a 2D incompressible turbulent flow with a K-Eps model in the geometry described above.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Constituents and turbulent flow}
\begin{block}{}

\begin{itemize}
\item Copy also the \textbf{Constituants\index{Constituants}} study which will give you examples for constituents keyword used for a 2D incompressible laminar flow.

\item Edit your data file in the Marche directory. First, change the name of the problem in order to add concentration equations (look for the good keyword in the Reference Guide).

\item Add 3 constituents with the same diffusivities ($\alpha=1m/s$) and associate the constituents to the problem.

\item Define the concentration equation into the problem (remember that concentrations will be a vector of 3 components) with correct initials ($C_1=0, C_2=0, C_3=0$) and boundaries conditions.

\item Use the Schmidt model to close the turbulence modelization in the  concentration equation.

\item Change the sources of the Navier-Stokes turbulence model to a \textbf{Source\_Transport\_K\_Eps\_aniso\_concen\index{Source\_Transport\_K\_Eps\_aniso\_concen} \{ C1\_eps 1.44 C2\_eps 1.92 C3\_eps 1. \} } to fit with the new concentration equation.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Constituents and turbulent flow}
\begin{block}{}

\begin{itemize}
\item Add into the fluid definition, the volume expansion coefficient for the concentration: \textbf{beta\_co\index{beta\_co}} as an uniform field fixed to 0.

\item You have also to add a gravity field which can be initialized to 0.

\item Run the calculation to see if it is ok.

\item Define a sub domain (in grey on the previous picture) with the keyword \textbf{Sous\_Zone\index{Sous\_Zone}} (like in \textbf{PCR} data file).

\item Add a source term for the second constituent only ($S_2=1m^{-3}$) applied on the sub domain thanks to the keyword \textbf{Champ\_Uniforme\_Morceaux\index{Champ\_Uniforme\_Morceaux}}.

\item Add \textbf{format lata\index{format lata}} in te post-processing block.

\item Add the keyword \textbf{concentration0, concentration1, concentration2} in the \textbf{fields} of the post-processing block to write the 3 concentrations into the .lata results file.

\item Run the calculation and check the results.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\section{{\bf{3D turbulent flow in a curved pipe}}} \label{prm_para}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{3D turbulent flow in a curved pipe}
\begin{block}{TrioCFD}

\begin{figure}
\includegraphics[width=0.25\textwidth]{PICTURES/pipe2.jpg}
\includegraphics[width=0.25\textwidth]{PICTURES/pipe1.jpg}
%\caption{Obstacle}
\end{figure}

Goals:
\begin{itemize}
\item Use of a RANS or LES model.
\item Use of a periodic box to initialize a fully developed turbulent flow.
\item Use of the TrioCFD parallel capabilities.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{3D turbulent flow in a curved pipe}
\begin{block}{TrioCFD}

\begin{itemize}
\item First initialize TrioCFD environment :\\
{\small{
\textbf{source /home/triou/env\_\textcolor{blue}{TrioCFD}\_X.Y.Z.sh }\\
\textbf{echo \$exec} \\
\textbf{echo \$project\_directory} \\
}}

\item Create a new directory and copy some data:\\
{\small{
\textbf{mkdir -p $\sim$/test/yourname/PeriodicBox} \\
\textbf{cd $\sim$/test/yourname/PeriodicBox} \\
\textbf{cp \$project\_directory/validation/share/Validation/Rapports\_automatiques/} \\
\hspace{4cm} \textbf{Validant/pas\_fini/PeriodicBox/src/* \; .} \\
}}
\vspace{0.2cm}
Notice that this directory correspond to an automated validation test case. 
If you want to run it and generated the pdf report, see the last exercise of this tutorial named "Validation form", but be careful this case is very slow !
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{3D turbulent flow in a curved pipe}
\begin{block}{TrioCFD}

\begin{itemize}
\item There are several files :\\
    \begin{itemize}
    \item [$\circ$] \textit{BuildMeshes.data}: To build the meshes\\
    \item [$\circ$] \textit{PeriodicBoxRANS.data}: To run the flow in the box with RANS model\\
    \item [$\circ$] \textit{DomainFlowRANS.data}: To run the flow in the domain with inlet steady conditions from the box domain\\
    \item [$\circ$] \textit{PeriodicBoxLES.data}: To run the flow in the box with LES model\\
    \item [$\circ$] \textit{DomainFlowLES.data}: To run the flow in the domain with inlet unsteady conditions from the box domain
    \end{itemize}

\item First, edit and read the BuildMeshes.data file.

\item If you wish to run a RANS simulation, open the PeriodicBoxRANS.data and DomainFlowRANS.data files.

\item Or if you wish to run a LES simulation, open the PeriodicBoxLES.data and DomainFlowLES.data files.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{3D turbulent flow in a curved pipe}
\begin{block}{TrioCFD}

\begin{itemize}
\item Then build the meshes:\\
\textbf{./prepare} \\
\textbf{trust BuildMeshes} \\
Notice that we use \textbf{"trust"} command line because this script will use the variable \$exec which is the path to the TrioCFD executable.

\item You can visualize the partitioned meshes with (MODEL=RANS or LES): \\
\textbf{trust -mesh\index{trust -mesh} PeriodicBoxMODEL}

\item Then, fix the maximal number of time steps in the time scheme using \textbf{nb\_pas\_dt\_max\index{nb\_pas\_dt\_max}} to 100 in the files PeriodicBoxRANS and PeriodicBoxLES and run the 2 cores parallel calculations, to initialize the turbulent flow in the box: \\
\textbf{trust PeriodicBoxRANS 2} \\
\textbf{trust PeriodicBoxLES 2} \\
(The full calculation in RANS takes approximately 1h and 10h in LES.)
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{3D turbulent flow in a curved pipe}
\begin{block}{TrioCFD}

\begin{itemize}
\item Open the file PeriodicBoxRANS.dt\_ev and PeriodicBoxLES.dt\_ev to read the last time of the two calculation after 100 time steps.

\item Once finished, open the file DomainFlowRANS.data and DomainFlowLES.data and change the maximal number of time steps to 10.

\item You can see that theses data files are constituted by 2 problems, one for the box and one for the domain.
    \begin {itemize}
    \item We use the velocity and temperature fields of the last time step of the PeriodicBoxRANS (or LES) calculation into the initial conditions of the pb\_box problem with the keyword "Champ\_fonc\_reprise\index{Champ\_fonc\_reprise}".
    \item In addition in the pb\_dom, the velocity and temperature fields of the pb\_box are used in the initial conditions of the pb\_dom throught the keyword "champ\_front\_recyclage".
    \end{itemize}

\item Run a 6 cores parallel calculation of the domain (it will stop by default after 10 times steps):\\
\textbf{trust DomainFlowRANS 6}\\
\textbf{trust DomainFlowLES 6}

\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{{\bf{Turbulent flow on a 3D step}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Turbulent flow on a 3D step}
\begin{block}{TrioCFD}

\begin{figure}
\includegraphics[width=0.75\textwidth]{PICTURES/marche3D.pdf}
%\caption{Obstacle}
\end{figure}

\textbf{Meshing}: 30x10x10 ($\Delta x=1m, \Delta y=0.2m, \Delta z=1m$)

\textbf{Fluid}: $\mu=5.10^{-5} kg.m^{-1}.s^{-1}, \rho=2 kg.m^{-3}$

\textbf{Boundaries conditions}: with in entry $R_e=\frac{U_0 H_{inlet} \rho}{\mu} = \frac{1 \times 1 \times 2}{5.10^{-5}} = 40000$\\
Inlet: $U_0=1 m.s^{-1}$\\
Outlet: $P_0=0$

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Turbulent flow on a 3D step}
\begin{block}{TrioCFD}

\begin{itemize}
\item First initialize TrioCFD environment :\\
{\small{
\textbf{source /home/triou/env\_\textcolor{blue}{TrioCFD}\_X.Y.Z.sh }\\
\textbf{echo \$exec} \\
\textbf{echo \$project\_directory} \\
}}

\item Copy the study named Marche3D: 
\textbf{trust -copy\index{trust -copy} Marche3D}

\item Edit the data file and: \\
    \begin{itemize}
    \item [$\circ$] Note that we use a "Pb\_Hydraulique\_Turbulent" problem with "Navier\_Stokes\_Turbulent" equations and a "modele\_turbulence\index{modele\_turbulence}" model.
    \item [$\circ$] Modify the fluid characteristics to perform a calculation at $R_e=50000$. For example, impose $\rho = 1 kg.m^{-3}$ and $\mu=2.10^{-5} kg.m^{-1}.s^{-1}$.
%    \item [$\circ$] Define a turbulent hydraulic problem (see Reference Guide).
    \item [$\circ$] Select the sub-grid Smagorinsky turbulence model with standard wall law instead of the "sous\_maille" model (LES).
    \item [$\circ$] Select the Quick\index{quick} convection scheme.
    \item [$\circ$] Post-process of velocity, pressure, vorticity, turbulent viscosity at the nodes and elements.
    \end{itemize}

\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Turbulent flow on a 3D step}
\begin{block}{TrioCFD}

\begin{itemize}

\item Run the calculation and post-process the main calculated fields.\\
\textbf{trust Marche3D} \\

\item Notice that we use \textbf{"trust"} command line because this script will use the variable \$exec which is the path to the TrioCFD executable.

\item Replace the sub-grid model by the standard k\_eps model (RANS).
\item Run the calculation and post-process of the velocity field to see the differences between the different turbulence models used.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




\section{{\bf{Tank filling (2D-single phase flow)}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Tank filling (2D-single phase flow)}
\begin{block}{We want to simulate the following flow:}

\begin{tabular}{cl}
\multirow{14}{*}{\includegraphics[width=0.3\textwidth]{PICTURES/tank2D.pdf}} & \textbf{Fluid}: Coloured water \tabularnewline
 & diffusion $D=10^{-9}m^{2}.s^{-1}$, \tabularnewline
 & $\rho=1000kg.m^{-3}$, $\mu=10^{-3}kg.m^{-1}.s^{-1}$\tabularnewline

 & \tabularnewline

 & \textbf{Boundary condition}:\tabularnewline

 & \textit{Inlet}: Velocity: $(V_{x},V_{y})=(V(t),0)$  \tabularnewline
 & with $V(t)=
    \begin{cases}
    1-(y-0.025/0.005)^{2} & ,\; t\leq0.5s\\
    0 & ,\; t>0.5s
    \end{cases}$ \tabularnewline

 & Concentration: $C=
    \begin{cases} 
    1 & ,\; t\leq0.5s\\
    0 & ,\; t>0.5s
    \end{cases}$ \tabularnewline
 & \textit{Outlet}: Pressure $P=0$\tabularnewline
 & \textit{Wall}: Velocity $V_{x}=0$, $V_{y}=0$ \tabularnewline

 & \tabularnewline

 & \textbf{Initial condition}: Concentration $C_0=0$, \tabularnewline
 & Velocity $V=0$ \tabularnewline
\end{tabular}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Tank filling (2D-single phase flow)}
\begin{block}{}

\begin{itemize}
\item Source the TRUST environment:\\
\textbf{source /home/triou/env\_TRUST\_X.Y.Z.sh}
\item Copy the study named \textbf{diagonale}. This test case deals with a 2D flow with Navier Stokes and the equation for one constituent.
\item Edit the data file and modify the fluid characteristics to the previous ones ($\mu, \rho, D$).
\item We want to modify the geometry of this problem to the previous picture. So we want to create 3 blocks like:
\end{itemize}

\begin{figure}
\includegraphics[width=0.2\textwidth]{PICTURES/tank2D_2.pdf}
%\caption{Obstacle}
\end{figure}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Tank filling (2D-single phase flow)}
\begin{block}{}

\begin{itemize}
\item Create the corresponding mesh with 3 blocks (start with $dx=dy=0.2cm$ which gives a total node number $Nx=51$ and $Ny=121$). 
    \begin{itemize}
    \item [$\circ$] Create a first block "Block1" which origin is (0, 0.03), $Nx=51$, $Ny=121$ (for $dx=dy=0.2cm$), $L=0.1 m$, $H=0.21 m$. Name the wall boundaries Left1, Outlet(=Top1) and Right1. (Don't forget the comma between two block definition.)
    \item [$\circ$] Create the second block "Block2" which origin is (0, 0.02), $Nx=51$, $Ny=6$ (for $dx=dy=0.2cm$), $L=0.1 m$, $H=0.01 m$. Name the wall boundaries Inlet(=Left2) and Right2.
    \item [$\circ$] Create the third block "Block3" which origin is (0, 0), $Nx=51$, $Ny=11$ (for $dx=dy=0.2cm$), $L=0.1 m$, $H=0.02 m$. Name the wall boundaries Left3, Bottom3 and Right3.
    \end{itemize}
\item Define the boundary wall, using the keyword \textbf{"RegroupeBord\index{RegroupeBord}"}.
\item You could also use facteurs and symx, symy keywords to define a refined mesh near the walls. 
\item Check the mesh with: \textbf{trust -mesh\index{trust -mesh} diagonale} and correct the mesh errors if needed.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Tank filling (2D-single phase flow)}
\begin{block}{}

\begin{itemize}
\item In the data file, change the values in the time scheme to finish the calculation at 1
second, and modify \textbf{dt\_min\index{dt\_min}} and \textbf{dt\_max\index{dt\_max}} values to let TRUST calculates itself its
time step.

\item Change values for the gravity to $-9.81 m.s^{-2}$ following y axe.

\item Note that the \textbf{beta\_co\index{beta\_co}} keyword may be useful in order to have a Boussinesq coupling between momentum and concentration equations ($\beta C_0 g(C-C_0$) source term added in Navier Stokes equation).

\item Change the initial and boundary conditions for Navier Stokes equation:
    \begin{itemize}
    \item [$\circ$] for the Outlet boundary, you have to impose $P=0$,
    \item [$\circ$] for the Wall boundary, you have to impose $V_x=V_y=0$ with \textbf{"paroi\_fixe\index{paroi\_fixe}"} keyword.,
    \item [$\circ$] for the Intlet boundary, you have to impose $(V_{x},V_{y})=(V(t),0)$ with 
    $V(t)=  
    \begin{cases}  
    1-(y-0.025/0.005)^{2} & ,\; t\leq0.5s\\
    0 & ,\; t>0.5s
    \end{cases}
    $. You will use the \textbf{Champ\_Front\_Fonc\_txyz\index{Champ\_Front\_Fonc\_txyz}} keyword for the velocity, to write something like: \\
    \textbf{Champ\_Front\_Fonc\_txyz $2$ $(1-((y-0.025)/0.005)^2)*(t<0.5)$ $0.$}\\
    Note: Use ($t[0.5)$ syntax if you prefer ($t<=0.5$)
    \end{itemize}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Tank filling (2D-single phase flow)}
\begin{block}{}

\begin{itemize}
\item Change the initial and boundary conditions for the constituent equation. 
    \begin{itemize}
    \item [$\circ$] You will also use \textbf{Champ\_Front\_Fonc\_txyz\index{Champ\_Front\_Fonc\_txyz}} field for the Inlet boundary condition for concentration.
    \item [$\circ$] For the Outlet, use the following keywords to insure the external concentration is 0:
                    \textbf{Frontiere\_ouverte C\_ext Champ\_front\_uniforme 1 0.} \\
    \item [$\circ$] For the Wall, the keyword for impermeable boundary condition for concentration is \textbf{paroi\index{paroi}}.
    \end{itemize}
\item Check you have high order schemes (i.e. \textbf{"Quick\index{quick}"} scheme) used in both equations to reduce numerical diffusion. 
\item Notice you could have suppressed diffusion term in concentration equation rather than using a small diffusion coefficient with:\\
\textbf{Diffusion \{ negligeable\index{negligeable} \}}
\item Add a concentration probe near the inlet (e.g.: at (0,0.025)).
\item Add a velocity segment probe (with 5 points between (0,0.021) and (0,0.029)) at the inlet boundary to see the time evolution of these two quantities (period 0.01s).
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Tank filling (2D-single phase flow)}
\begin{block}{}

\begin{itemize}
%\item Change the period to 0.1s in the post processing definition (keyword \textbf{dt\_post}).
\item Run the study and follow the time evolution with the probes:\\
\textbf{trust -evol\index{trust -evol} diagonale \&} \\
"Start computation!" button and "Plot" or "Plot on same" for probes.
\item Check the flow rate in inlet boundary in the diagonale\_pb\_Debit.out file (plotted on the right of the PLOT2D window). You should find a value near $6.8 \; 10^{-3} m^2.s^{-1}$.
\item Use VisIt to post process the results at t=0.2, t=0.4s and t=0.7s. VisIt has some interesting feature for this study. It can give concentration histogram to check the numerical diffusion in the concentration equation: Add $\rightarrow$ Histogram $\rightarrow$ CONCENTRATION\_ELEM\_dom.
The volume of colored water (in $m^3$) is given by $Vol(t)= 6.66.10^{-3} t$ before $t=0.5s$ and $Vol(t)=3.33.10^{-3}$ after.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Tank filling (2D-single phase flow)}
\begin{block}{$\rightarrow$ VEF}

\begin{itemize}
\item Copy diagonale.data to diagonale\_VEF.data.
\item Triangulate your mesh (\textbf{trianguler\index{trianguler}} keyword).
\item In this new file, change the discretization (\textbf{VEFPreP1B\index{VEFPreP1B}} instead of \textbf{VDF\index{VDF}}).
\item Use \textbf{muscl\index{muscl}} instead of \textbf{quick\index{quick}} scheme.
\item And you can switch \textbf{GCP\index{GCP}} solver by \textbf{Cholesky\index{Cholesky}} solver of the Petsc library (direct method which may need large amount of RAM memory) to increase the speed resolution of the pressure linear system:\\
\textbf{GCP \{ precond ssor \{ omega 1.5 \} seuil 1.e-6 \} $\rightarrow$ Petsc Cholesky \{ \}}
\item Run the calculation. You must have an error, and TRUST stop the calculation. 
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Tank filling (2D-single phase flow)}
\begin{block}{$\rightarrow$ VEF}

\begin{itemize}
\item As TRUST explain, to avoid this problem, you can:
    \begin{itemize}
    \item [$\circ$] change the \textbf{trianguler\index{trianguler}} keyword to \textbf{trianguler\_h\index{Trianguler\_H}}, 
    \item [$\circ$] or use the \textbf{VerifierCoin\index{VerifierCoin}} keyword. For this, after this first error you must find a "diagonale\_VEF.decoupage\_som" file in your directory, so you can use it by adding:\\
    \textbf{VerifierCoin dom \{ read\_file diagonale\_VEF.decoupage\_som \} }\\
    just after "trianguler\index{trianguler} dom". This will subdivides inconsistent 2D/3D cells used with VEFPreP1B\index{VEFPreP1B} discretization (cf Reference Guide).
    \end{itemize}

\item Run the calculation and compare the results between \textbf{VDF/quick} and \textbf{VEFPreP1B/muscl} which must take much more time!
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\section{{\bf{Tank filling (3D-two phases flow)}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Tank filling (3D-two phases flow)}
\begin{block}{TrioCFD}

%\begin{figure}
%\includegraphics[width=0.4\textwidth]{PICTURES/tank3D.pdf}
%%\caption{Obstacle}
%\end{figure}

\begin{tabular}{cl}
\multirow{14}{*}{\includegraphics[width=0.35\textwidth]{PICTURES/tank3D}}
 & \textbf{Liquid}: $\rho=1000kg.m^{-3},$ \tabularnewline
 & $\mu=2,82.10^{-4}kg.m^{-1}.s^{-1},$ \tabularnewline
 & $\sigma=0.05N.m^{-1},\; D=10^{-6}m^{2}.s^{-1}$\tabularnewline
 & \tabularnewline
 & \textbf{Gas}: $\rho=100kg.m^{-3},$\tabularnewline
 & $\mu=2,82.10^{-4}kg.m^{-1}.s^{-1}$\tabularnewline
 & \tabularnewline
 & \textbf{Boundary conditions}:  \tabularnewline
 & Up : Free outlet, \hspace{0.5cm} Wall : $V=0$ \tabularnewline
 & Down: $V(x,y,z)=(0,0,10^{-3}m.s^{-1})$\tabularnewline
 & \tabularnewline
 & \textbf{Initial conditions}: $V=0$, \tabularnewline
 & $C=e^{(-((x-0.02)^{2}+(y-0.02)^{2}+(z-0.03)^{2})/0.03^{2})}$ \tabularnewline
 & \tabularnewline
 & N.B.: The interface between the air and the gaz\tabularnewline
 & is a parabolic function.\tabularnewline
\end{tabular}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Tank filling (3D-two phases flow)}
\begin{block}{TrioCFD}

\begin{itemize}
\item First initialize TrioCFD environment :\\
\textbf{source /home/triou/env\_\textcolor{blue}{TrioCFD}\_X.Y.Z.sh }\\
\textbf{echo \$exec} 

\item Copy the study named \textbf{FTD\_all\_VDF}: \textbf{trust -copy\index{trust -copy} FTD\_all\_VDF}

\item This test case deals with a 3D two phase flow in a tank with one initial interface between liquid and gas, a droplet, and a rotating solid in the liquid. The model used is the Discontinuous Front Tracking method and the mesh is 3D structured mesh.

\item Notice that:
    \begin{itemize}
    \item [$\circ$] 2D Discontinuous Front Tracking method has not been intensively tested yet.
    \item [$\circ$] the type of the problem: \textbf{Probleme\_FT\_disc\_gen\index{Probleme\_FT\_disc\_gen}} in the data file. This refers to the Discontinuous Front Tracking method.
    \item [$\circ$] the keyword \textbf{modele\_turbulence\index{modele\_turbulence}}. Navier-Stokes equation of the Discontinuous Front Tracking problem needs the read of this keyword even if the flow is laminar. In this case, use the \textbf{nul\index{nul}} keyword just after \textbf{modele\_turbulence\index{modele\_turbulence}}. Else, specify the turbulence model chosen.
    \end{itemize}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Tank filling (3D-two phases flow)}
\begin{block}{TrioCFD}

\begin{itemize}
\item Increase the height of the tank (0.06 to 0.12).

\item Add a second drop above the first one, at $z=0.08$ (keywords \textbf{ajout\_phase0\index{ajout\_phase0}} could be useful to add other interfaces, cf Reference Guide for \textbf{ajout\_phase0/ajout\_phase1\index{ajout\_phase1}} keywords). Don't forget the comma between the two definition of the drops.

\item Change the \textbf{dt\_post\index{dt\_post}} period of the 3 post processing blocks (0.05 to 0.01). The first one (add \textbf{format lata\index{format lata}}) is the classical block for post processing probes and fields. Here, we want to see the concentration field and the \textbf{"indicatrice\_interf"} field. Value of this field is 0 for liquid and 1 for gas, so the interface is located at "indicatrice" value 0.5.

\item Change the interpolation location of \textbf{indicatrice\_interf\index{indicatrice\_interf}} and the \textbf{concentration} fields in the first post processing block, by adding the keyword \textbf{elem} just after the fields: the values in the post processing tool will be plotted at the center of each element of the mesh.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Tank filling (3D-two phases flow)}
\begin{block}{TrioCFD}

\begin{itemize}
\item The second post processing block is the new syntax to post process interfaces moving meshes. You can visualize it with \textbf{VisIt}. 

\item On each interface, you can plot several fields ie: curvature with \textbf{courbure} keyword and velocity interface with \textbf{vitesse} keyword, \textbf{pe} field is for debugging purpose, it is useless here, you can suppress it) on several locations (on nodes with \textbf{sommets} keyword, on cells with \textbf{elements} keyword).

\item Run the calculation. Follow the time step evolution by having a look at the \textbf{dt\_ev} file. It contains on each line the physical time, the time step, security factor and residuals.

\item Post process to visualize the interface and the concentration field.

\item You can increase the number of cells to have a finest simulation or also change to VEF discretization.

\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\section{{\bf{Salom\'e: 3D VEF mesh}}} \label{salome}
%\subsection{Salom\'e to create a 3D VEF mesh}
\subsection{Cylinder}
%\subsubsection{Cylinder}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Salom\'e to create a 3D VEF mesh: Cylinder}
%\begin{block}{}

\begin{figure}
\includegraphics[width=0.7\textwidth]{PICTURES/salome1_2.jpg}
%\caption{Obstacle}
\end{figure}

%\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Cylinder}
\begin{block}{Create a geometry}

\begin{itemize}
\item Create a directory and run Salom\'e (we suppose it is installed):\\
\textbf{mkdir -p $\sim$/test/yourname/salome/exo1} \\
\textbf{cd $\sim$/test/yourname/salome/exo1} \\

\textbf{/export/home/salome/SALOME-7.7.1-FD18/salome} \\
\# or if no local version: {\scriptsize{\textbf{/home/salome/salome}}} \\
\# take the network version but to be used for testing NOT for work.

\item Create a new study: File $\rightarrow$ New

\item Select the Geometry module into the SALOME drop-down menu (contains all the modules).

\item Create a first geometry with: New Entity $\rightarrow$ Primitives $\rightarrow$ Cylinder
\item Save your study in hdf format (Salome format) frequently.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Cylinder}
\begin{block}{Create a geometry}

\begin{itemize}
\item Specify Radius $R=100$ and Height $H=300$ for the cylinder (the default values). Then Apply and Close.
\begin{figure}
\includegraphics[width=0.3\textwidth]{PICTURES/salome2.jpg}
%\caption{Obstacle}
\end{figure}

\item Rotate, zoom, move the geometry by switching to "Interaction style switch": Mouse icon.

\item Create groups for the geometry to define the top, the bottom and the lateral parts of the cylinder: New Entity $\rightarrow$ Group $\rightarrow$ Create Group

\item Select the good Shape Type ($\rightarrow \square$ surface).
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Cylinder}
\begin{block}{Create a geometry}

\begin{itemize}
\item Give a Group Name for the top: "Inlet".
\item Click on the arrow button of the Main Shape field and select the "Cylinder\_1" in the "Object browser" or in the visualization window.\\
\item Select the shape defining the top of the cylinder on the visualization window then Add $\rightarrow$ Apply.\\

\item Select the shape defining the part on the window then Add $\rightarrow$ Apply.\\
%\textbf{Warning}: Mouse icon should be unselected to select a shape.
\begin{figure}
\includegraphics[width=0.3\textwidth]{PICTURES/salome3.jpg}
%\caption{Obstacle}
\end{figure}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Cylinder}

\begin{block}{Create a geometry}
\begin{itemize}
\item Do the same for the two other parts:
    \begin{itemize}
    \item [$\circ$] For the lateral: "Wall"
    \item [$\circ$] For the bottom: "Outlet" (you can rotate the cylinder to click on the bottom).
    \end{itemize}
\item Close the window once the 3 groups has been created. Check that they appear in the Object Browser (by clicking on the "$\triangleright$" in front of the "Cylinder\_1" object).
\end{itemize}
\end{block}

\begin{block}{Create a mesh}
\begin{itemize}
\item \label{salome_mesh} Now, switch to the Mesh module in the SALOME drop-down menu.
\item Select the Cylinder\_1 in the Object Browser and Right Click $\rightarrow$ 'Show' to visualize the geometry or click on the 'eye' next to the Cylindre\_1 object.
\item Create a mesh with: Mesh $\rightarrow$ Create Mesh
\item Select the Geometry used for the mesh if not selected by clicking on the Cylinder\_1 object in the Object Browser.
\end{itemize}
\end{block}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Cylinder}
\begin{block}{Create a mesh}

\begin{itemize}
\item Choose Netgen 1D-2D-3D algorithm and click on "Apply and Close".
\item Select the object Mesh\_1 in the Object Browser and Right Click $\rightarrow$ Compute (or Mesh $\rightarrow$ Compute).
\item A tabular must appear with the number of triangles, quadrangles... Click on "Close".
\item Hide the geometry by selecting the Cylinder\_1 in the Object Browser and Right Click $\rightarrow$ Hide (or click on the eye).
\begin{tabular}{cc}
\includegraphics[width=0.39\textwidth]{PICTURES/salome4} & \includegraphics[width=0.21\textwidth]{PICTURES/salome5}\tabularnewline
Mesh & Create Groups from Geometry \tabularnewline
\end{tabular}

\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Cylinder}
\begin{block}{Export your mesh in MED format}

\begin{itemize}
\item Now, we are going to create groups for the mesh, by using the geometry groups: Mesh $\rightarrow$ Create Groups from Geometry.
\item Click on "Mesh\_1" object in the Object Browser to select it.
\item Then push the arrow button of Elements/Geometry if it's not already done.
\item Select together the 3 groups (Inlet, Wall and Outlet) with CTRL+left click in the Cylinder\_1 object of the Object Browser, then press Apply and Close.
\item Check that the 3 boundaries are in the "Group of Faces" of the Mesh\_1 object in the Object Browser.
\item Export your mesh with the MED format :\\
Select the Mesh\_1 object then Right Click $\rightarrow$ Export $\rightarrow$ MED file (or File $\rightarrow$ Export $\rightarrow$ MED file).
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Cylinder}
\begin{block}{Read your mesh with TRUST}

\begin{itemize}
\item \label{read_mesh} Now build a data file named dom.data for TRUST:\\
\vspace{0.2cm}
\begin{tabular}{|l|}
\hline 
\textbf{dimension 3 }\tabularnewline
\textbf{domaine dom }\tabularnewline
\textbf{Lire\_med family\_names\_from\_group\_names dom Mesh\_1 Mesh\_1.med }\tabularnewline
\textbf{Discretiser\_domaine\index{discretiser\_domaine} dom }\tabularnewline
\textbf{Postraiter\_domaine\index{Postraiter\_domaine} \{ domaine dom fichier mesh format lata\index{format lata}
\}}\tabularnewline
\hline 
\end{tabular}

\item Run the data file and post process the mesh with VisIt:\\
\textbf{source  /home/triou/env\_TRUST\_X.Y.Z.sh} \\
\textbf{trust dom} \\
\textbf{visit\index{visit} -o mesh.lata} \\
\vspace{0.2cm}
\textbf{Warning}: The more common error is to forget to define the boundaries with the groups for the mesh. The error in TRUST is printed and detected during the discretization where all the faces of the mesh (in particular the boundary faces) are built.

\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Cylinder}
\begin{block}{Refine your mesh and use viscous layers}

Goal: Improve the mesh for TRUST near the wall by using viscous layers.

\begin{itemize}
\item Create a new mesh named "Refined\_mesh" with: Mesh $\rightarrow$ Create Mesh

\item Select the Cylinder\_1 geometry in the Object Browser.

\item Select the "Tetrahedron (Netgen)" or "MG-Tetra" 3D algorithm.

\item Click on the wheel of "Add. Hypothesis" $\rightarrow$ "Viscous Layers" with:
    \begin{itemize}
    \item [$\circ$] Total thickness: 30
    \item [$\circ$] Number of layers: 3
    \item [$\circ$] Stretch factor: 1.1
    \item [$\circ$] Add to "Faces without layers" the 2 geometry groups "Inlet" and "Outlet" of Cylinder\_1 object (select or unselect the mouse icon).
    \item [$\circ$] Click OK
    \end{itemize}

\item Add a 2D algorithm: "Netgen 1D-2D" or "MG-CADSurf".
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Cylinder}
\begin{block}{Refine your mesh and use viscous layers}

\begin{itemize}
\item Click on the wheel of "Hypothesis" $\rightarrow$ "Netgen 2D parameters" or "MG-CADSurf parameters":
    \begin{itemize}
    \item For "Netgen 2D parameters":
        \begin{itemize}
        \item [$\circ$] Change "Fineness" from "Moderate" to "Very Fine".
        \item [$\circ$] Select "Allow Quadrangles".
        \item [$\circ$] Click OK.
        \end{itemize}
    \item For "MG-CADSurf parameters", change "User size" to 20. Click OK.
    \end{itemize}
\item "Apply and Close" the close mesh window.
\item Select the Refined\_Mesh object in the Object Browser and Right click $\rightarrow$ Compute
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Cylinder}
\begin{block}{Refine your mesh and use viscous layers}

\begin{itemize}
\item You should have a refined mesh with a mix of tetra, hexa, pyramid, prism elements for Netgen algorithms, and a mix of tetra and prisms for MG algorithms:

\begin{center}
\begin{tabular}{cc}
\includegraphics[width=0.28\textwidth]{PICTURES/salome6a.jpg}
 & 
\includegraphics[width=0.28\textwidth]{PICTURES/salome6b.jpg}
\tabularnewline
Netgen & MG
\end{tabular}
\end{center}

\item As TRUST accepted only tetras elements, you can quickly tetraedrize:
    \begin{itemize}
    \item [$\circ$] Select the Refined\_Mesh in the Object Browser.
    \item [$\circ$] "Modification" $\rightarrow$ "Split Volums" and select "Tetrahedron".
    \item [$\circ$] Don't change the parameters, and click "Apply and Close".
    \end{itemize}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Cylinder}

\begin{block}{Refine your mesh and use viscous layers}
\begin{itemize}
\item As usual, define the mesh boundaries with Groups:
    \begin{itemize}
    \item [$\circ$] Select the Refined\_Mesh, Right click $\rightarrow$ Create Groups from Geometry.
    \item [$\circ$] Select "Inlet", "Outlet", "Wall" with Ctrl+click in the Cylinder\_1 object, then Apply and Close.
    \end{itemize}

\item Export the mesh:
    \begin{itemize}
    \item [$\circ$] Select the Refined\_mesh, Right click $\rightarrow$ Export $\rightarrow$ MED file.
    \item [$\circ$] Save into a Refined\_Mesh.med file.
    \end{itemize}

\item Save your work in hdf format ("File" $\rightarrow$ "Save/Save As..."), and in python format with "File" $\rightarrow$ "Dump Study..."
\end{itemize}
\end{block}


\begin{block}{Run with TRUST}
\begin{itemize}
\item Change or create a new data file for TRUST to read and visualize your refined mesh.

\item \textbf{N.B.}: The solutions of the exercise (mesh.py file for the first mesh and prism.py file for the second mesh) are located here: \$TRUST\_ROOT/doc/TRUST/exercices/salome.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{Revolution}
%\subsubsection{Revolution}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Salom\'e to create a 3D VEF mesh: Revolution}
%\begin{block}{}

\begin{figure}
\includegraphics[width=0.7\textwidth]{PICTURES/salome9.jpg}
%\caption{Obstacle}
\end{figure}

%\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Salom\'e to create a 3D VEF mesh: Revolution}
\begin{block}{Create a geometry}

\begin{itemize}
\item Create a directory and run Salom\'e (we suppose it is installed):\\
\textbf{mkdir -p $\sim$/test/yourname/salome/exo2} \\
\textbf{cd $\sim$/test/yourname/salome/exo2} \\

\textbf{/export/home/salome/SALOME-7.7.1-FD18/salome} \\
\# or if no local version: {\scriptsize{\textbf{/home/salome/salome}}} \\
\# take the network version but to be used for testing NOT for work.

\item Create a new study: File $\rightarrow$ New.

\item Select the Geometry module into the SALOME drop-down menu.

\item Create points : New Entity $\rightarrow$ Basic $\rightarrow$ Point\\
\begin{tabular}{lll}
Vertex\_1 (0,0,0)       &   Vertex\_2 (1,0,0)       &   Vertex\_3 (1,0,0.3) \tabularnewline
Vertex\_4 (0.75,0,0.3)  &   Vertex\_5 (0.375,0,1)   &   Vertex\_6 (0.75,0,1.6) \tabularnewline
Vertex\_7 (1,0,1.6)     &   Vertex\_8 (1,0,2)       &   Vertex\_9 (0,0,2) \tabularnewline
\end{tabular}

Then "Apply and Close"

\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Revolution}
\begin{block}{Create a geometry}

\begin{figure}
\includegraphics[width=0.28\textwidth]{PICTURES/salome7.jpg}
%\caption{Obstacle}
\end{figure}

\begin{itemize}

\item Create edges:
    \begin{itemize}
    \item [$\circ$] New Entity $\rightarrow$ Basic $\rightarrow$ Line
        \begin{itemize}
        \item [$\diamond$] Line\_1 with Vertex\_1 and Vertex\_2
        \item [$\diamond$] Line\_2 with Vertex\_2 and Vertex\_3
        \item [$\diamond$] Line\_3 with Vertex\_3 and Vertex\_4
        \item [$\diamond$] Line\_4 with \textbf{Vertex\_6} and \textbf{Vertex\_7}
        \item [$\diamond$] Line\_5 with Vertex\_7 and Vertex\_8
        \item [$\diamond$] Line\_6 with Vertex\_8 and Vertex\_9
        \item [$\diamond$] Line\_7 with Vertex\_9 and Vertex\_1
        \item [$\diamond$] Then Apply and Close.
        \end{itemize}
    \end{itemize}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Revolution}
\begin{block}{Create a geometry}

\begin{itemize}
\item Create edges:
    \begin{itemize}
    \item [$\circ$] New Entity $\rightarrow$ Basic $\rightarrow$ Arc
        \begin{itemize}
        \item [$\diamond$] Arc\_1 with Vertex\_4, Vertex\_5 and Vertex\_6.
        \item [$\diamond$] Then Apply and Close.
        \end{itemize}
    \end{itemize}

\item Create a wire: New Entity $\rightarrow$ Build $\rightarrow$ Wire
    \begin{itemize}
    \item [$\circ$] Wire\_1 on \underline{edges} with Line\_1,... , Line\_7 and Arc\_1 (with "Ctrl" button).
    \item [$\circ$] Then Apply and Close.
    \end{itemize}

\item Create a face: New Entity $\rightarrow$ Build $\rightarrow$ Face.
    \begin{itemize}
    \item [$\circ$] Face\_1 with Wire\_1 and "Apply and Close".
    \end{itemize}

\item Create a revolution cylinder: New Entity $\rightarrow$ Generation $\rightarrow$ Revolution.
    \begin{itemize}
    \item [$\circ$] named Cylinder\_1,
    \item [$\circ$] with Face\_1 in Objects,
    \item [$\circ$] click on the arrow button next "Axis" and select OZ in the Object Browser,
    \item [$\circ$] set the angle to $360^o$ and "Apply and Close".
    \end{itemize}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Revolution}
\begin{block}{Create a geometry}

\begin{figure}
\includegraphics[width=0.28\textwidth]{PICTURES/salome8.jpg}
%\caption{Obstacle}
\end{figure}

\begin{itemize}
\item Create groups for the geometry to define the top, the bottom and the lateral parts of the cylinder: New Entity $\rightarrow$ Group $\rightarrow$ Create Group.
\item Save your study in hdf format ("File" $\rightarrow$ "Save/Save As..."), and in python format with "File" $\rightarrow$ "Dump Study..."
\item Now you can create the mesh in the same way than page \pageref{salome_mesh}.
\item \textbf{N.B.}: You can find the solutions of this exercise (revolution.py) in \$TRUST\_ROOT/doc/TRUST/exercices/salome.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{T-shape}
%\subsubsection{T-shape}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Salom\'e to create a 3D VEF mesh: T-shape}
%\begin{block}{}

\begin{figure}
\includegraphics[width=0.7\textwidth]{PICTURES/salome17.jpg}
%\caption{Obstacle}
\end{figure}

%\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Salom\'e to create a 3D VEF mesh: T-shape}
\begin{block}{Create a geometry}

\begin{itemize}
\item Create a directory and run Salom\'e (we suppose it is installed):\\
\textbf{mkdir -p $\sim$/test/yourname/salome/exo3} \\
\textbf{cd $\sim$/test/yourname/salome/exo3} \\

\textbf{/export/home/salome/SALOME-7.7.1-FD18/salome} \\
\# or if no local version: {\scriptsize{\textbf{/home/salome/salome}}} \\
\# take the network version but to be used for testing NOT for work.

\item Create a new study: File $\rightarrow$ New.

\item Select the Geometry module into the SALOME drop-down menu.

\item Create two cylinders: New Entity $\rightarrow$ Primitives $\rightarrow$ Cylinders:\\
Cylinder\_1: radius 0.5, height 5. Then "Apply".\\
Cylinder\_2: radius 0.3, height 3. Then "Apply and Close".
\item Save your study in hdf format (Salome format) frequently.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{T-shape}
\begin{block}{Create a geometry}

\begin{itemize}
\item Rotate Cylinder\_2: Operations $\rightarrow$ Transformation $\rightarrow$ Rotation\\
Name:Rotation\_1, Object: Cylinder\_2, Axis: 'OY', Angle: 90 \\
Then "Apply and Close".

\item Translate Rotation\_1: Operations $\rightarrow$ Transformation $\rightarrow$ Translation\\
Name: Translation\_1, Object: Rotation\_1, Dx=Dy=0, Dz=1.5 \\
Then "Apply and Close".
\end{itemize}

\begin{center}
\begin{tabular}{ccc}
\includegraphics[width=0.25\textwidth]{PICTURES/salome11} & \includegraphics[width=0.25\textwidth]{PICTURES/salome12} & \includegraphics[width=0.28\textwidth]{PICTURES/salome13} \tabularnewline
Rotation & Translation & Fuse \tabularnewline
\end{tabular}
\end{center}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{T-shape}
\begin{block}{Create a geometry}

\begin{itemize}
\item Fuse Cylinder\_1 and Translation\_1: Operations $\rightarrow$ Boolean $\rightarrow$ Fuse\\
Name: Fuse\_1, Selected Objects: 2\_Objects (use Ctrl key to select Cylinder\_1 and Translation\_1 in the Object Browser). \\
Then "Apply and Close".

\begin{figure}
\includegraphics[width=0.5\textwidth]{PICTURES/salome14.jpg}
%\caption{Obstacle}
\end{figure}

\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{T-shape}
\begin{block}{Create a geometry}

\begin{itemize}
\item We are now going to create the boundaries: New Entity $\rightarrow$ Explode \\
    \begin{itemize}
    \item [$\circ$] Main Object: Fuse\_1, Sub-shape type: Face, select "Select sub-shape" and click on the surface Outlet and "Apply".
    \item [$\circ$] This will create a face named "Face\_1" in the Fuse\_1 object (click on the "$\blacktriangleright$"), rename it "Outlet" (by right-clicking and "rename").
    \end{itemize}

\begin{figure}
\includegraphics[width=0.48\textwidth]{PICTURES/salome15.jpg}
%\caption{Obstacle}
\end{figure}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{T-shape}
\begin{block}{Create a geometry}

\begin{itemize}
\item Do the same for "Inlet\_x" and "Inlet\_z".
\item We are now going to create the boundary Wall: New Entity $\rightarrow$ Group $\rightarrow$ Create group:\\
Shape Type: surface, Name: Wall, Main Shape: Fuse\_1.\\
Click on the surface of the Cylinder\_1 then "Add", click on the surface of Translation\_1 then "Add" and "Apply and Close".
\begin{figure}
\includegraphics[width=0.25\textwidth]{PICTURES/salome16.jpg}
%\caption{Obstacle}
\end{figure}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{T-shape}

\begin{block}{Create a geometry}
\begin{itemize}
\item We are now going to create the point "Corner": New Entity $\rightarrow$ Explode \\
    \begin{itemize}
    \item [$\circ$] Main Object: Fuse\_1, Sub-shape type: Vertex, select "Select sub-shape" and click on the chosen point and "Apply and Close".
    \item [$\circ$] This will create a vertex name "Vertex\_1", rename it "Corner" (by right-clicking and "rename").
    \end{itemize}
\end{itemize}
\end{block}

\begin{block}{Create a mesh}
\begin{itemize}
\item \label{salome_mesh} Now, switch to the Mesh module in the SALOME drop-down menu.
\item Select the Fuse\_1 in the Object Browser and Right Click $\rightarrow$ 'Show' to visualize the geometry or click on the 'eye' next to the Fuse\_1 object.
\item Create a mesh with: Mesh $\rightarrow$ Create Mesh.
\item Select the Geometry used for the mesh if not selected by clicking on the Fuse\_1 object in the Object Browser.
\end{itemize}
\end{block}

\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{T-shape}
\begin{block}{Create a mesh}

\begin{itemize}
\item Choose "Tetrahedron (Netgen)" for 3D algorithm.
\item Click on the wheel of "Add. Hypothesis" $\rightarrow$ "Viscous Layers" and set:
    \begin{itemize}
    \item [$\circ$] Total thickness: 0.05
    \item [$\circ$] Number of layers: 3
    \item [$\circ$] Stretch factor: 1.1
    \item [$\circ$] Extrusion method: Node Offset
    \item [$\circ$] Add to "Faces with layers (Wall)" the geometry group "Wall" of Fuse\_1 object in the Object Browser (select or unselect the mouse icon). Click on "Add".
    \item [$\circ$] Click "OK".
    \end{itemize}
\item Choose "Netgen 1D-2D" for 2D algorithm.
\item Click on the wheel of "Hypothesis" $\rightarrow$ "Netgen 2D parameters" and set for "Arguments" menu:
    \begin{itemize}
    \item [$\circ$] Max. Size: 0.6
    \item [$\circ$] Min. Size: 0
    \item [$\circ$] without "Second Order"
    \item [$\circ$] Finess: Custom
    \end{itemize}

\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{T-shape}
\begin{block}{Create a mesh}

\hspace{1cm} $\color{darkblue}\circ$ {\small{Growth rate: 0.1}}\\
\hspace{1cm} $\color{darkblue}\circ$ {\small{Nb. segs per Edge: 2}}\\
\hspace{1cm} $\color{darkblue}\circ$ {\small{Nb. segs per Radius: 4}}\\
\hspace{1cm} $\color{darkblue}\circ$ {\small{Select "Limit size by Surface Curvature", "Optimize", "Fuse Coincident Nodes \\
\hspace{1,3cm} on Edges and Vertices".}}\\
\hspace{1cm} $\color{darkblue}\circ$ {\small{Unselect "Allow Quadrangles".}}\\

\begin{itemize}
\item For "Local Size" menu:
    \begin{itemize}
    \item [$\circ$] Select "Corner" object in the Object Browser and click on "On Vertex" in the "Hypothesis Construction" window.
    \item [$\circ$] Double-click on the value in the table and set it to "0.01".
    \item [$\circ$] Click "OK".
    \end{itemize}
\item Click on "Apply and Close".
\item Select the Mesh\_1 object in the Object Browser and Right click $\rightarrow$ Compute.
\item You should have a mesh with a mix of tetra and prism elements.

\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{T-shape}
\begin{block}{Create a mesh}

\begin{itemize}
\item As TRUST accepted only tetras elements, you can quickly tetraedrize:
    \begin{itemize}
    \item [$\circ$] Select Mesh\_1 in the Object Browser.
    \item [$\circ$] "Modification" $\rightarrow$ "Split Volums" and select "Tetrahedron".
    \item [$\circ$] Don't change the parameters, and click "Apply and Close".
    \end{itemize}

\item Define the mesh boundaries with Groups:
    \begin{itemize}
    \item [$\circ$] Select the Mesh\_1, Right click $\rightarrow$ Create Groups from Geometry.
    \item [$\circ$] Select "Inlet\_x", "Inlet\_z", "Outlet" and "Wall" with Ctrl+click in the Fuse\_1 object.
    \item [$\circ$] Then Apply and Close.
    \end{itemize}

\item Export the mesh:
    \begin{itemize}
    \item [$\circ$] Select the Mesh\_1, Right click $\rightarrow$ Export $\rightarrow$ MED file.
    \item [$\circ$] Save into a Mesh\_1.med file.
    \end{itemize}

\item Save your study in hdf format ("File" $\rightarrow$ "Save/Save As..."), and in python format with "File" $\rightarrow$ "Dump Study..."

\item \textbf{N.B.}: You can find the solutions of this exercise (T\_shape.py) in \$TRUST\_ROOT/doc/TRUST/exercices/salome.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{T-shape}
\begin{block}{Run with TRUST}

\begin{itemize}
\item Copy the T\_shape.data file in your directory:\\
\textbf{cp \$TRUST\_ROOT/doc/TRUST/exercices/salome/T\_shape.data  .}

\item Run it with TRUST:\\
\textbf{trust T\_shape}\\
or in parallel with:\\
\textbf{make\_PAR.data T\_shape}\\
\textbf{trust PAR\_T\_shape 4}\\

\item You can visualize the results with Visit or Salom\'e by opening the T\_shape\_0000.med file for sequential calculation or PAR\_T\_shape\_0000.med for parallel calculation.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{T-shape}
\begin{block}{Visu with Visit}

\begin{figure}
\includegraphics[width=0.5\textwidth]{PICTURES/salome18.jpg}
%\caption{Obstacle}
\end{figure}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{{\bf{Gmsh meshing tool}}} \label{gmsh}
\subsection{2D VEF mesh}
%\subsection{Gmsh}
%\subsubsection{2D VEF mesh}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Gmsh to create a 2D VEF mesh}
\begin{block}{Geometry which will be created, based on a TrioCFD validation test case geometry}

\begin{figure}
\includegraphics[width=0.7\textwidth]{PICTURES/gmsh.pdf}
%\caption{Obstacle}
\end{figure}

\begin{itemize}
\item Create a directory and copy an example:\\
{\footnotesize{
\textbf{mkdir \, -p \, $\sim$/test/yourname/gmsh} \\
\textbf{cd \, $\sim$/test/yourname/gmsh} \\
\textbf{source /home/triou/env\_\textcolor{blue}{TrioCFD}\_X.Y.Z.sh }\\
\textbf{echo \$project\_directory} \\
\textbf{dir=\$project\_directory/validation/share/Validation/Rapports\_automatiques/Validant} \\
\textbf{cp \, \$dir/pas\_fini/Drag/src/shape.geo \, file.geo} \\
\textbf{nedit file.geo \& } \\
\textbf{gmsh file.geo \&} }}\\
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Gmsh to create a 2D VEF mesh}
\begin{block}{}

\begin{itemize}
\item First configure gmsh to show points, lines, and surface numbers of the geometry. In menu Tools $\rightarrow$ Options $\rightarrow$ Geometry $\rightarrow$ Visibility, select Lines, Surfaces, Point labels, Line labels, Surface labels, Volume labels close this window. 
\item Save definitively your choices with File $\rightarrow$ Save Options As default.

\item Now, look at the file.geo file, you can see the definition of parameters, points, lines... You can see the position of the points and lines with theirs numbers in gmsh.

\item Modify the file to suppress the obstacle. We want to keep only 4 points and 4 lines, so you have to suppress the points 5,6,7,8 and the lines 1,3,4,5. For this, you have to:
    \begin{itemize}
    \item [$\circ$] comment (with "//") the definition of the points 5,6,7 and 8.
    \item [$\circ$] comment the definition of the lines 1,3,4,5. Note that the "Circle" is a line so "Circle(1)=Line(1)".
    \item [$\circ$] modify the line(2), it will now links points 1 and 2.
    \item [$\circ$] comment the "Physical Line" named "Shape" which use the line(1) (= Circle(1)) and the line(3).
    \end{itemize}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Gmsh to create a 2D VEF mesh}
\begin{block}{}

\hspace{1cm} $\color{darkblue}\circ$ {\small{ suppress the numbers 4 and 5 in the "Physical Line" "Axis". It refers to the \\
\hspace{1.4cm} lines 4 and 5 which don't exist anymore.}}\\
\hspace{1cm} $\color{darkblue}\circ$ {\small{ suppress the numbers 1,3,4 and 5 in the "Line Loop(1)".}}\\
\hspace{1cm} $\color{darkblue}\circ$ {\small{ set H to 2 and L to 10. (You can comment D, E, param and X definitions.)}}

\begin{itemize}
\item Press "Reload" in the gmsh GUI $\rightarrow$ Geometry to update the geometry visualization.
\item Now we will had the circle. Note that you can only create circle arcs with angle strictly smaller than $\pi$!
    \begin{itemize}
    \item [$\circ$] create the middle of the circle like "Point(10)=\{1,1,0,lc\};" where the triplet "1,1,0" are the coordinates of the point and "lc" the thickness of the cells next this point.
    \item [$\circ$] create 4 points around this point, which will correspond to the 4 arc of the circle: \\
Point(11)=\{1.25,1,0,lc2\};\\
Point(12)=\{1,1.25,0,lc2\};\\
Point(13)=\{0.75,1,0,lc2\};\\
Point(14)=\{1,0.75,0,lc2\};
    \end{itemize}

\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Gmsh to create a 2D VEF mesh}
\begin{block}{}

\hspace{1cm} $\color{darkblue}\circ$ {\small{ define the 4 arcs of the circle with this points: \\
\hspace{1.4cm} Circle(10)=\{11,10,12\};\\
\hspace{1.4cm} Circle(11)=\{12,10,13\};\\
\hspace{1.4cm} Circle(12)=\{13,10,14\};\\
\hspace{1.4cm} Circle(13)=\{14,10,11\}; "}}\\
\hspace{1cm} $\color{darkblue}\circ$ {\small{ create a "Physical Line" for the circle: \\
\hspace{1.4cm} "Physical Line("Circle") = \{10,11,12,13\};"\\
\hspace{1.4cm} This name will be used in your TRUST data file as the name of your \\
\hspace{1.4cm} boundaries.}}\\
\hspace{1cm} $\color{darkblue}\circ$ {\small{create a line loop for the circle just after the first line loop:\\
\hspace{1.4cm} Line Loop(2) = \{10,11,12,13\}; \\}}
\hspace{1cm} $\color{darkblue}\circ$ {\small{Add the number of this line loop in the "Plane Surface(1)":\\
\hspace{1.4cm} Plane Surface(1) = \{1,2\}; }}


\begin{itemize}
\item Suppress the Physical lines "Axis" and "Top" and create a physical line named "Wall" which regroups the top and the bottom of this geometry (lines 2 and 7).
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{3D VEF mesh}
%\subsubsection{3D VEF mesh}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Gmsh to create a 3D VEF mesh}
\begin{block}{}

\begin{itemize}
\item Select "Mesh" in the drop-down menu of gmsh and mesh in 2D.
\item Export it to a MED file: "File" $\rightarrow$ "Save As..." and name the file file.med. (Keep the default options.) You can verify your mesh by opening it with gmsh: \textbf{gmsh file.med \&}.
\item Build a TRUST data file with the \textbf{Postraiter\_domaine\index{Postraiter\_domaine}} keyword, to read the mesh (like in the Salome exercise page \pageref{read_mesh}). Visualize the mesh with VisIt.
\item Then we will try to create a 3D mesh, by using the Extrusions feature of Gmsh. See more about extrusions in \textcolor{blue}{\underline{http://geuz.org/gmsh/doc/texinfo/gmsh.html}}.
\item Save your initial file in a new one named file3D.geo.
\item Comment your "Physical lines", they will not be used here.
\item Add the line "Extrude \{0,0,1\} \{ Surface\{1\} ; \}" just before the definition of the physical surface.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Gmsh to create a 3D VEF mesh}
\begin{block}{}

\begin{itemize}
\item Comment the line "Physical Surface("domain") = \{1\};" in 3D we will have a "Physical Volume" which will be define at the end of the .geo file.
\item Define the "Physical Surface" which will be the boundaries of your geometry with the number of the surfaces which can be read on the geometry plotted by gmsh:\\
Physical Surface("Inlet") = \{38\};\\
Physical Surface("Outlet") = \{30\};\\
Physical Surface("Wall") = \{1,26,34,55\};\\
Physical Surface("Obstacle") = \{42,46,50,54\};\\
\item Define you physical volume, you can see its number in yellow in the window:\\
Physical Volume("dom") = \{1\};

%\item In 3D, you will use "Plane Surface" to define the boundaries of your domain and "Physical Surface" (instead of Physical Line in 2D) to name these boundaries: \\
%\begin{tabular}{ll}
%{\small{Line Loop(1) = \{15,6,1,14\};}}         & {\small{// Line loop of several lines}}   \tabularnewline
%{\small{Line Loop(2) = \{15,16,17,18\};}}       & {\small{// Line loop of several lines}}   \tabularnewline
%{\small{Plane Surface(1) = \{ 1,2 \} ;}}        & {\small{// Surface/boundary defined}}     \tabularnewline
%{\small{Physical Surface("Inlet") = \{1\};}}    & {\small{// Naming boundary is MANDATORY}} \tabularnewline
%\end{tabular}
%\item You will need to define a volume and a physical volume at the end of .geo file:
%\begin{tabular}{ll}
%{\small{Surface Loop(1) = { 1,2,8,12,16,20 } ;}}    & {\small{ // Surface Loop of Plane Surfaces }}     \tabularnewline
%{\small{Volume(1) = { 1 } ;}}                       & {\small{ // Volume defined }}                     \tabularnewline
%{\small{Physical Volume("domain") = 1;}}            & {\small{ // Naming domain is MANDATORY }}         \tabularnewline
%\end{tabular}

\item Select the "Mesh" tool in the drop-down menu pf gmsh and mesh in 3D your geometry. It takes a few minutes, to reduce this time, increase the size of your cells by changing the values of lc.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Gmsh to create a 3D VEF mesh}
\begin{block}{}

\begin{itemize}
\item You can use the "Optimize 3D (Netgen)" algorithm to optimize your mesh.

\item Export your mesh to a MED file. Run gmsh again on this exported MED file to check everything is defined:\\
\textbf{gmsh file.med \&}

\item Now, read the mesh by TRUST. You can, for example, take the first exercise and create a Obstacle\_VEF.data file (from a copy of Obstacle\_VDF.data) to read the MED file and run the simulation on the unstructured mesh.
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{TRUST Wizzard for 3D VEF mesh}
%\subsubsection{3D VEF mesh}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{TRUST Wizzard for 3D VEF mesh}
\begin{block}{}

\begin{itemize}
\item Open the TRUST wizzard:\\
\textbf{trust -wiz\index{trust -wiz}}

\item Create an hydraulic problem with:
    \begin{itemize}
    \item in "Turbulent model" tab, set a laminar turbulent model.
    \item in "Domain" tab, input the path to your 3D mesh file in med format. The wizzard will find the name of your mesh.
    \item in "Boundary condition" tab, select a boundary condition of type:
        \begin{itemize}
        \item "Input" for your Inlet boundary and set your velocity field to ( 1. 0. 0. ),
        \item "Wall" with no velocity for your Obstacle boundary,
        \item "Output" with pressure field set to 0. for your Outlet boundary,
        \item "Symetry" for your Wall boundary.
        \end{itemize}
    \item in "Initial condition" tab, set your velocity field to ( 0. 0. 0. ).
    \item in "Incompressible flow" tab, choose a predefined field like "Water 20 deg".
    \end{itemize}
\item Then click on "Validate" to see if your parameters are ok.
\item You can see the message "All ok!" at the bottom left of the window.
\item You can save your session at the .JSon format by clicking on "Save ...".
\end{itemize}
\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{TRUST Wizzard for 3D VEF mesh}
\begin{block}{}

\begin{itemize}
\item Click on "Start ...", a window opens to save your data file. Name it for example "test\_wiz.data" and clock on "Save".
\item The TRUST PLOT2D tool opens, click on "Start computation!".
\item An error occurs! Open your data file with "Edit data" button.
\item Correct the expression of gravity field adding a third composant.
\item Add a "\textbf{tmax}" value (for example 'tmax 0.1') and suppress the max number of iterations.
\item Save it and run your simulation.
\item It must be long because of the size of the cells. You can decrease it and create another mesh with gmsh to run faster.
\end{itemize}
\textbf{Warning}: TRUST Wizzard is still in development. Not all models are available yet.
\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%\subsection{Xprepro}
%%%%\subsubsection{3D VDF mesh}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%\begin{frame}
%%%%\begin{columns}[c] 
%%%%\column{.45\textwidth}
%%%%\tableofcontents[sections={1-7},currentsection, currentsubsection]
%%%%\column{.5\textwidth} 
%%%%\tableofcontents[sections={8-14},currentsection, currentsubsection]
%%%%\end{columns}
%%%%\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%\begin{frame}
%%%%\frametitle{Xprepro to create a 3D VDF simple mesh}
%%%%\begin{block}{First exercise}

%%%%\begin{figure}
%%%%\includegraphics[width=0.7\textwidth]{PICTURES/xprepro0.pdf}
%%%%%\caption{Obstacle}
%%%%\end{figure}

%%%%In this exercise, you will learn how to create a 2D mesh with Xprepro. 
%%%%Note that in Xprepro, we dig a geometry in an initial block of matter.
%%%%\vspace{0.2cm}

%%%%\begin{itemize}
%%%%\item Create a directory:\\
%%%%\textbf{mkdir \, -p \, $\sim$/test/yourname/Xprepro/exo1} \\
%%%%\textbf{cd \, $\sim$/test/yourname/Xprepro/exo1} \\
%%%%\textbf{source /home/triou/env\_TRUST\_X.Y.Z.sh }\\
%%%%\textbf{Xprepro \&} 
%%%%\end{itemize}

%%%%\end{block}
%%%%\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%\begin{frame}
%%%%\frametitle{Xprepro to create a 3D VDF simple mesh}
%%%%\begin{block}{}

%%%%\begin{itemize}
%%%%\item You can see two windows: 
%%%%    \begin{itemize}
%%%%    \item [$\circ$] the command window: xprepro.tcl and 
%%%%    \item [$\circ$] the list of existing objects: viewlist (empty for the moment).
%%%%    \end{itemize}
%%%%\item Click on "Default" button to begin from a cube. Read the pop-up window and click on "Ok". A new nedit window appears, opening a file named "maillagedefaut" in which we will set the values of the parameters used in our geometry.
%%%%\item We want to create a cube of lenght L=10m, height H=1m and width l=1m with a cylinder of radius R=0.4m at one meter from the left side of the cube. So the center of the cylinder is located at the point $x=xomin+L/10$, $y=yomin+H/2$ with $(xomin, yomin, zomin)$ the origin of the frame.
%%%%\item Set theses values in the window "maillagedefaut":
%%%%\begin{itemize}
%%%%    \item [$\circ$] Add the declaration of the parameter "radius" in the first line of the "maillagedefaut" file.
%%%%    \item [$\circ$] Set the values of $xomin=0$, $xomax=10$, $yomin=0$, $yomax=2$, $zomin=0$ and $zomax=1$.
%%%%    \item [$\circ$] Add the initialization of the radius: $radius=0.4$.
%%%%\end{itemize}
%%%%\end{itemize}

%%%%\end{block}
%%%%\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%\begin{frame}
%%%%\frametitle{Xprepro to create a 3D VDF simple mesh}
%%%%\begin{block}{}

%%%%\begin{figure}
%%%%\includegraphics[width=0.8\textwidth]{PICTURES/xprepro1.pdf}
%%%%%\caption{Obstacle}
%%%%\end{figure}

%%%%\begin{itemize}
%%%%\item Save your file.
%%%%\item You can see the definition of $XM(1/nx)$, $YM(1/ny)$ and $ZM(1/nz)$, they represent the boundaries of the domain with a width of $\varepsilon=0.01$.
%%%%\item You can see on the top of the "viewlist" window the values of $nx$, $ny$ and $nz$. For the moment they are fixed to $4$, it is the minimal number of nodes in an Xprepro mesh. Indeed the first point in x direction is on $XM(1)$, the second on $xomin$, the third on $xomax$ and the fourth $XM(nx)$.
%%%%\item Note that the "real" number of cells in the final domain is: $Nx=nx-3$, $Ny=ny-3$ and $Nz=nz-3$.
%%%%\end{itemize}

%%%%\end{block}
%%%%\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%\begin{frame}
%%%%\frametitle{Xprepro to create a 3D VDF simple mesh}
%%%%\begin{block}{}

%%%%\begin{itemize}
%%%%\item Note that the "maillagefefaut" file and your prepro file are saved in the directory $\sim$/test/yourname/Xprepro/model.
%%%%\item Click on "Modify" on the top of the "viewlist" window to change the values of $nx$, $ny$ and $nz$ to have $NX=100$, $Ny=20$ and $Nz=10$. Then "Ok". 
%%%%\item Think to save your geometry with "Save file prepro"!
%%%%\item You can see in this window that there are some "?", we will complete them now.
%%%%\item Note that the lines whom finish by a "(comm)" are commented lines.
%%%%\item Choose the index number of the matter by double-clicking on the line 5 "filling up of the domain...", set the index of the matter to $1000$. (For matter, we must use positive numbers, matter with a negative number will be deleted.)
%%%%\item Double-click on the line 7 "back boundary...", change the name of the boundary from "back boundary" to "Wall", and set the matter index to $-1000$. (Negative numbers for boundaries.)
%%%%\end{itemize}

%%%%\end{block}
%%%%\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%\begin{frame}
%%%%\frametitle{Xprepro to create a 3D VDF simple mesh}
%%%%\begin{block}{}

%%%%\begin{itemize}
%%%%\item Do the same for the lines 8 to 12:
%%%%    \begin{itemize}
%%%%    \item [$\circ$] line 8, change the "front boundary" name to "Wall", INDMAT=$-1000$,
%%%%    \item [$\circ$] line 9, change the "left boundary" name to "Inlet", INDMAT=$-2000$,
%%%%    \item [$\circ$] line 10, change the "right boundary" name to "Outlet", INDMAT=$-3000$,
%%%%    \item [$\circ$] line 11, change the "bottom boundary" name to "Bottom", INDMAT=$-1000$,
%%%%    \item [$\circ$] line 12, change the "top boundary" name to "Top", INDMAT=$-1000$.
%%%%    \end{itemize}
%%%%\item Add the cylinder, click on "Add", then click on the "? $\square$" button and select "cylinder".
%%%%\item Name it "Obstacle", set the values of (AC) and (BC) with C the center of the cylinder so (AC, BC) are the coordinates of C in the plan xOy, so $AC=xomin+(xomax-xomin)/10$ and $BC=yomin+(yomax-yomin)/2$.
%%%%\item Set the Radius to "radius".
%%%%\item Set $CMIN=zomin$ and $CMAX=zomax$, $CMAX-CMIN$ correspond to the cylinder width.
%%%%\item Set IDIR to $3$, the cylinder axe and INDMAT to $-9000$ (to make a hole) then "Ok".

%%%%\end{itemize}

%%%%\end{block}
%%%%\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%\begin{frame}
%%%%\frametitle{Xprepro to create a 3D VDF simple mesh}
%%%%\begin{block}{}

%%%%\begin{itemize}
%%%%\item The new line defining the cylinder appears in the "viewlist" window (save your prepro file).
%%%%\item Click on "Modeling run..." in the command window. A pop-up window appears with the nodes list, click "Ok".
%%%%\item Click on "Pre-mesh visualisation", VisIt opens. You can:
%%%%    \begin{itemize}
%%%%    \item [$\circ$] visualize your mesh with Add $\rightarrow$ Mesh $\rightarrow$ dom\_IJK and
%%%%    \item [$\circ$] visualize the matter indexes with Add $\rightarrow$ Pseudocolor $\rightarrow$ INDMAT\_ELEM\_dom\_IJK.
%%%%    \end{itemize}
%%%%\item We have a box but no hole! In fact we cannot see the hole because it is inside the box and it doesn't pass through it.
%%%%\end{itemize}

%%%%\begin{figure}
%%%%\includegraphics[width=0.63\textwidth]{PICTURES/xprepro2.pdf}
%%%%%\caption{Obstacle}
%%%%\end{figure}

%%%%\end{block}
%%%%\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%\begin{frame}
%%%%\frametitle{Xprepro to create a 3D VDF simple mesh}
%%%%\begin{block}{}

%%%%\begin{itemize}
%%%%\item So we must change the values of CMIN and CMAX in the cylinder parameters, to put $CMIN=zomin-\varepsilon$ and $CMAX=zomax+\varepsilon$
%%%%\item Close VisIt, and click on "Modeling run..." and then "Pre-mesh visualization".
%%%%\item Note that a cell is composed of a matter if its barycenter is in this matter's zone.
%%%%\item Close VisIt, click on "Pre-processing run...", you can see the names of the boundaries in function of the indexes that we gave. For exemple, the boundary number 4 is made of the boundaries "Wall", "Wall", Bottom" and "Top" and it's TRUST name will be "Wall\_Wall\_Bottom\_Top".
%%%%\item You can change the names of theses boundaries, to have the name you want.
%%%%\item To give a name to a boundary is not mandatory for the boundaries with the same matter inder. You have just to name almost one of it.
%%%%\item Click on "Get geom", a nedit window opens with a TRUST data file named "defaut.mesh".
%%%%\end{itemize}

%%%%\end{block}
%%%%\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%\begin{frame}
%%%%\frametitle{Xprepro to create a 3D VDF simple mesh}
%%%%\begin{block}{}

%%%%\begin{itemize}
%%%%\item Save this file with the name "channel.data", you can see that your geometry is in the file "defaut\_Pb1.geom".
%%%%\item Quit Xprepro.
%%%%\item Edit your channel.data file and add at the end of the file: \\
%%%%{\small{
%%%%\textbf{Postraiter\_domaine\index{Postraiter\_domaine} \{ domaine dom\_pb1 fichier dom\_pb1.lata format lata\index{format lata} \} \\
%%%%discretiser\_domaine\index{discretiser\_domaine} dom\_pb1 \\
%%%%End }
%%%%}}
%%%%\item Run the file: \textbf{trust channel}
%%%%\item Visualize your mesh with: \textbf{visit\index{visit} -o dom\_pb1.lata \& }
%%%%\end{itemize}

%%%%\end{block}
%%%%\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%\subsubsection{2D VDF mesh}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%\begin{frame}
%%%%\begin{columns}[c] 
%%%%\column{.45\textwidth}
%%%%\tableofcontents[sections={1-7},currentsection, currentsubsection]
%%%%\column{.5\textwidth} 
%%%%\tableofcontents[sections={8-14},currentsection, currentsubsection]
%%%%\end{columns}
%%%%\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%\begin{frame}
%%%%\frametitle{Xprepro to create a 2D VDF mesh}
%%%%\begin{block}{Second exercise}

%%%%In this exercise, you will learn how to create a 2D mesh with Xprepro. 

%%%%\begin{figure}
%%%%\includegraphics[width=0.7\textwidth]{PICTURES/xprepro.pdf}
%%%%%\caption{Obstacle}
%%%%\end{figure}

%%%%The radius of the cylinders is 0.2m and the distances between cylinders are 0.2m in the y direction and 0.6m in the x direction. \\
%%%%%You will have a look at the "virus" example (button Examples) to see how to build a loop in the viewlist.

%%%%\begin{itemize}
%%%%\item Create a directory: Run Xprepro in the TRUST environment:\\
%%%%\textbf{mkdir \, -p \, $\sim$/test/yourname/Xprepro/exo2} \\
%%%%\textbf{cd \, $\sim$/test/yourname/Xprepro/exo2} \\
%%%%\textbf{source /home/triou/env\_TRUST\_X.Y.Z.sh }\\
%%%%\textbf{Xprepro \&} 
%%%%\end{itemize}

%%%%\end{block}
%%%%\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%\begin{frame}
%%%%\frametitle{Xprepro to create a 2D VDF mesh}
%%%%\begin{block}{}

%%%%\begin{itemize}
%%%%\item First, have a look at the "Examples..." ("Picture" button and if you are interested by one "Copy and Read" button).
%%%%%\item First, have a look at the Examples (Copy and Read button on virus example) to understand how you will use fortran code in the viewlist to create loops for building your cylinders.

%%%%\item Then, click on the button "Default" to define the initial block and edit the dimensions file. 
%%%%\item Note that the files "maillagedefaut" and "defaut.prep" are saved in your directory (with "save" in nedit for "maillagedefaut" and "Save file prepro" in Xprepro for defaut.prep).

%%%%\item It is a 2D geometry, so we will define:
%%%%    \begin{itemize}
%%%%    \item [$\circ$] xomin=0.,
%%%%    \item [$\circ$] xomax=10.,
%%%%    \item [$\circ$] yomin=0.,
%%%%    \item [$\circ$] yomax=2.,
%%%%    \item [$\circ$] zomin=0.,
%%%%    \item [$\circ$] zomax=0.01.,
%%%%    \item [$\circ$] eps=0.0001 (tolerance) and
%%%%    \item [$\circ$] radius=0.2 (don't forget to declare it).
%%%%    \end{itemize}
%%%%\item Save the file.
%%%%\end{itemize}

%%%%\end{block}
%%%%\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%\begin{frame}
%%%%\frametitle{Xprepro to create a 2D VDF mesh}
%%%%\begin{block}{}

%%%%\begin{itemize}
%%%%\item Click "Modify" on the viewlist to modify the nodes number NX=203, NY=43, NZ=4.
%%%%\item Set the matter index to 1000, line 5.
%%%%\item Build the boundary blocks:
%%%%    \begin{itemize}
%%%%    \item [$\circ$] line 7, change the "back boundary" name to \textbf{lateral}, INDMAT=$0$,
%%%%    \item [$\circ$] line 8, change the "front boundary" name to \textbf{""}, INDMAT=$0$,
%%%%    \item [$\circ$] line 9, change the "left boundary" name to \textbf{inlet}, INDMAT=$-1000$,
%%%%    \item [$\circ$] line 10, change the "right boundary" name to \textbf{outlet}, INDMAT=$-2000$,
%%%%    \item [$\circ$] line 11, change the "bottom boundary" name to \textbf{""}, INDMAT=$0$,
%%%%    \item [$\circ$] line 12, change the "top boundary" name to \textbf{""}, INDMAT=$0$.
%%%%    \end{itemize}

%%%%\item The coordinates of the center of the first cylinder, which after will be duplicated, are (x0, y0)=(0.6, 0.4). So the distance between to cylinder center is $dx=0.8$ and $dy=0.3$. Declare and initialize this parameters $(x0, y0, dx, dy)$ in your "maillagedefaut" file.

%%%%\item Think about how to create 2 Fortran nesteed loops to copy the first cylinder in the two directions X and Y.
%%%%\end{itemize}

%%%%\end{block}
%%%%\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%\begin{frame}
%%%%\frametitle{Xprepro to create a 2D VDF mesh}
%%%%\begin{block}{}

%%%%\begin{itemize}
%%%%\item Create them with the button "Add", select "(fortran code)" instead of "?$\square$" and write your loops in fortran.
%%%%\item Check the other objects in the viewlist and save your work with the button "Save file" prepro then check the name of the boundaries with "Boundaries informations".
%%%%\item Run the model with "Modeling run...". A window is opened where you will check the nodes coordinates of the mesh.
%%%%\item Click on "Pre-mesh visualization" to check your pre-mesh.

%%%%\item Create a 2D cut slice in the XY plane: with "Add" button, choose an object of "Meshing creation 2D" type and name it coupe\_2D. Set $POS=0$, $IDIR=3$, $INDMAT=-5000$.
%%%%\item Click "Modeling run..." then "Pre-mesh visualization".
%%%%\item Warning, it is always a 3D model in Xprepro, even if you wish a 2D mesh. By default, you see the indexes between 1000 and -3000. If you don't see the cylinders, create a 2D slice in the XY plane in VisIt to see inside the 3D pre-mesh.
%%%%\end{itemize}

%%%%\end{block}
%%%%\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%\begin{frame}
%%%%\frametitle{Xprepro to create a 2D VDF mesh}
%%%%\begin{block}{}

%%%%\begin{itemize}
%%%%\item Zoom onto the boundaries to check the boundary blocks are all defined.

%%%%\item Click "Pre-processing run" to create the final mesh (check there is no error messages).

%%%%\item Click on "Get geom" to generate the TRUST .geom file in your study. It opens a nedit windows with a TRUST data file, save it in your repository with the name "dom\_1.data".
%%%%\item Suppress the first lines in comments "\#" and the "\textbackslash{}n" ending a commentary line.
%%%%\item Add at the end of the file:\\
%%%%\textbf{Discretiser\_domaine\index{discretiser\_domaine} dom\_1} \\
%%%%\textbf{Postraiter\_domaine\index{Postraiter\_domaine} \{ domaine dom\_1 fichier mesh format lata\index{format lata} \} }
%%%%\item Visualize your 2D mesh with VisIt.
%%%%\item If you wish, build a data file to read your mesh and run the flow around the cylinders.
%%%%\end{itemize}

%%%%\end{block}
%%%%\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\section{{\bf{Validation form}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Validation form}
\begin{block}{Example of Validation form:}

\begin{figure}
\includegraphics[width=0.3\textwidth]{PICTURES/valid1.jpg}
\includegraphics[width=0.3\textwidth]{PICTURES/valid2.jpg}
\includegraphics[width=0.3\textwidth]{PICTURES/valid3.jpg}
%\caption{Obstacle}
\end{figure}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Validation form}
\begin{block}{}

\begin{itemize}
\item First copy the validation form named Source\_canal\_perio:\\
{\small{
\textbf{mkdir -p $\sim$/test/yourname/validation} \\
\textbf{cd  $\sim$/test/yourname/validation} \\
\textbf{VERIF=\$TRUST\_ROOT/Validation/Rapports\_automatiques/Verification} \\
\textbf{cp -r \$VERIF/Verification\_codage/Source\_canal\_perio \, .} \\
\textbf{cd Source\_canal\_perio}
 }}\\

\item Build the report:\\
\textbf{Run\_fiche\index{Run\_fiche} -xpdf} \\
or\\
\textbf{Run\_fiche\index{Run\_fiche}} \\
\textbf{evince build/rapport.pdf \&} 
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Validation form}
\begin{block}{}

\begin{itemize}
\item Now, we are going to change the validation form (Examples are given in pages 10 \& 11 of the HowTo\_Validation.pdf note):\\
\textbf{nedit src/Canal.prm \&}
    \begin{itemize}
    \item [$\circ$] Add the mesh plot in the report. For this, at end of .prm file, introduce a new block with "visu" keyword:\\
    \textbf{Chapter \{ }  \\
    \hspace{0.3cm} \textbf{Title "Additional information"} \\
    \hspace{0.3cm} \textbf{Visu \{ } \\
    \hspace{0.6cm} \textbf{Title "Mesh visualization" } \\
    \hspace{0.6cm} \textbf{Mesh} \textit {lata\_file\_name  domain\_name [color]} \\
    \hspace{0.3cm} \textbf{\} } \\
    \textbf{\} } \\
    \item [$\circ$] You can help with:
        \begin{itemize}
        \item [$\diamond$] {\scriptsize{\$TRUST\_ROOT/Validation/Outils/Genere\_courbe/doc/manuel.xhtml\#paramVisu}}
        \item [$\diamond$] {\scriptsize{\$TRUST\_ROOT/Validation/Outils/Genere\_courbe/doc/exemples/visu.prm}}
        \end{itemize}
    \item [$\circ$] Save the .prm file and re-build the report without running the calculations:\\
    \textbf{Run\_fiche\index{Run\_fiche} \, -not\_run} \\
    \end{itemize}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Validation form}
\begin{block}{}

\begin{itemize}
\item Add the evolution of residus in the report in log scale (Cf. .dt\_ev file). For this, introduce a new block with "Figure" and "Curve" keywords:
    \begin{itemize}
    \item [$\circ$] Complete the chapter "Additional information" with a new block "Figure":\\
    {\scriptsize{
%    \textbf{Chapter \{}  \\
%    \hspace{.3cm} \textbf{Title "Additional information"}  \\
    \hspace{.3cm} \textbf{Figure \{}  \\
    \hspace{.6cm} \textbf{Title "Residus evolution"}  \\
    \hspace{.6cm} \textbf{LabelX "Time (s)"}  \\
    \hspace{.6cm} \textbf{LabelY "Residu"}  \\
    \hspace{.6cm} \textbf{LogX}  \\
    \hspace{.6cm} \textbf{LogY}  \\
    \hspace{.6cm} \textbf{Include\_description\_Curves 0}  \\
    \hspace{.6cm} \textbf{Curve \{ }  \\
    \hspace{.8cm} \textbf{legend} \textit{data\_file\_name.data}  \\
    \hspace{.8cm} \textbf{file} \textit{data\_file\_name.dt\_ev} \\
    \hspace{.8cm} \textbf{columns \, \$}\textit{column\_number\_for\_x} \, \textbf{\$}\textit{column\_number\_for\_y }  \\
    \hspace{.8cm} \textbf{style lines} \\
    \hspace{0.6cm} \textbf{\}}  \\
    \hspace{0.6cm} \textbf{...}  \\
    \hspace{.3cm} \textbf{\}}  \\
%    \textbf{\}}  \\
    }}
    \item [$\circ$] You can help with:
        \begin{itemize}
        \item [$\diamond$] {\scriptsize{\$TRUST\_ROOT/Validation/Outils/Genere\_courbe/doc/manuel.xhtml\#paramFigure}}
        \item [$\diamond$] {\scriptsize{\$TRUST\_ROOT/Validation/Outils/Genere\_courbe/doc/manuel.xhtml\#paramCourbe}}
        \item [$\diamond$] {\scriptsize{\$TRUST\_ROOT/Validation/Outils/Genere\_courbe/doc/exemples/impl.prm}}
        \end{itemize}
    \end{itemize}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Validation form}
\begin{block}{}

\hspace{1cm} $\color{darkblue}\circ$ {\small{Visualize the pressure field at last time: complete the chapter "Additional \\
\hspace{1.3cm} information" with a new block "Visu" using "PseudoColor" keywords. The \\
\hspace{1.3cm} name of field and localization must be uppercase letter: }}

{\footnotesize{
%\hspace{1.5cm} \textbf{Chapter \{ } \\
%\hspace{1.8cm} \textbf{Title Additional information} \\
\hspace{1.3cm} \textbf{Visu \{ } \\
\hspace{1.6cm} \textbf{Title "Visualization of pressure field at last time" } \\
\hspace{1.6cm} \textbf{Description "Pressure field..."} \\
\hspace{1.6cm} \textbf{Pseudocolor} \textit{data\_file\_name.lata domain\_name FIELD POSITION} \\
\hspace{1.6cm} \textbf{Cycles}  \textit{cycle\_numbers}\\
\hspace{1.6cm} \textbf{Width} \textit{size\_in\_cm} \\
\hspace{1.3cm} \textbf{\}} \\
%\hspace{1.5cm} \textbf{\}} \\
}}
{\small{
\hspace{1.3cm} NB: Cycle '-1' correspond to the last time. \\
\hspace{1.3cm} NB: You can use the "magnitude" keyword to visualize the velocity field \\
\hspace{1.3cm} without using arrows.
}}
\vspace{0.2cm}

\hspace{1cm} $\color{darkblue}\circ$ {\small{ Save and close the .prm file and build the report with the options:\\
\hspace{1.3cm} (Options are given in page 7 of the HowTo\_Validation.pdf note) }}\\
\hspace{1.3cm} {\small{\textbf{Run\_fiche\index{Run\_fiche} -xpdf -not\_run}}}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Validation form}
\begin{block}{}

\begin{itemize}
\item Now, we are going to extract the number of cells and the last time in three of the .err files and write the results in .dat files via a post\_run script.

    \begin{itemize}
    \item [$\circ$] Create a "post\_run" file in the src directory containing:\\
    {\footnotesize{
    \textbf{nb1=\` \,grep "Total number of elements" std.err $|$ awk '\{print \$NF\}' \`} \\
    \textbf{nb2=\` \,grep "Total number of elements" debit.err $|$ awk '\{print \$NF\}' \`} \\
    \textbf{nb3=\` \,grep "Total number of elements" debit2.err $|$ awk '\{print \$NF\}' \`} \\
    \textbf{echo \$nb1 \$nb2 \$nb3 $>$ nbcells.dat} \\
    \textbf{tp1=\` \,grep "Backup of the field" std.err $|$ awk '\{print \$NF\}' $|$ head -n 1 \`} \\
    \textbf{tp2=\` \,grep "Backup of the field" debit.err $|$ awk '\{print \$NF\}' $|$ head -n 1 \`} \\
    \textbf{tp3=\` \,grep "Backup of the field" debit2.err $|$ awk '\{print \$NF\}' $|$ head -n 1 \`} \\
    \textbf{echo \$tp1 \$tp2 \$tp3 $>$ lastime.dat} \\
    }}

    \item [$\circ$] Add a table to display the results of .dat files: complete the chapter "Additional information" by introducing a new block with "table" and "line" keywords.\\
    You can help with:
        \begin{itemize}
        \item [$\diamond$] {\scriptsize{\$TRUST\_ROOT/Validation/Outils/Genere\_courbe/doc/manuel.xhtml\#paramTableau}}
        \item [$\diamond$] {\scriptsize{\$TRUST\_ROOT/Validation/Outils/Genere\_courbe/doc/manuel.xhtml\#paramLigne}}
        \item [$\diamond$] {\scriptsize{\$TRUST\_ROOT/Validation/Outils/Genere\_courbe/doc/exemples/tableau.prm}}
        \end{itemize}
    \end{itemize}
\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Validation form}
\begin{block}{}

\hspace{1cm} $\color{darkblue}\circ$ {\small{ The table block will looks like:\\
{\footnotesize{
%\textbf{Chapter \{ } \\
%\hspace{0.3cm} \textbf{Title "Additional information"} \\
\hspace{1.4cm} \textbf{Table \{} \\
\hspace{1.7cm} \textbf{Title "Number of cells and last time results"} \\
\hspace{1.7cm} \textbf{Nb\_columns} number\_of\_colomns\_without\_the\_first\_one \\
\hspace{1.7cm} \textbf{Label} label\_of\_the\_first\_column $|$ label\_of\_the\_second\_column ...\\
\hspace{1.7cm} \textbf{Line \{} \\
\hspace{2cm} \textbf{legend} title\_of\_the\_first\_line\\
\hspace{2cm} \textbf{file} name\_of\_the\_file.dat\\
\hspace{1.7cm} \textbf{\}} \\
\hspace{1.7cm} \textbf{...} \\
\hspace{1.4cm} \textbf{\}} \\
%\textbf{\}} \\
}}
}}

\hspace{1cm} $\color{darkblue}\circ$ {\small{ Save the .prm file in src directory and build the report with a new option:\\
\hspace{1.4cm} \textbf{Run\_fiche\index{Run\_fiche} -xpdf -post\_run}
}}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\frametitle{Validation form}
\begin{block}{}

\begin{itemize}
\item Now we are going to modify the "prepare" file in "src" directory in order to add a fourth test case: "debit4"
    \begin{itemize}
    \item [$\circ$] "debit4" correspond to "std" test case with zero initial velocity and imposed flow rate to $2 m^3/s$ on "periox" boundary.
    \item [$\circ$] Add a line in the "prepare" file using the "sed" command to create the new data file like the other ones:\\
    \textbf{nedit src/prepare \& }
    \end{itemize}

\item We are going to update the validation form.
    \begin{itemize}
    \item [$\circ$] Modify the "Canal.prm" file in "src" directory to take into account the new test case debit4. Add in the \textbf{Parameters} block :\\
    \hspace{0.3cm} \textbf{TestCase . Debit4.data}\\

    \item [$\circ$] Build the report by running the 4 test case concurrently and not sequentially:\\
    \textbf{Run\_fiche\index{Run\_fiche} -parallel\_run -xpdf}
    \item [$\circ$] You can add the results of this test case to your "visu" and "table".
    \end{itemize}

\end{itemize}

\end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Index}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{columns}[c] 
\column{.45\textwidth}
\tableofcontents[sections={1-7},currentsection, currentsubsection]
\column{.5\textwidth} 
\tableofcontents[sections={8-14},currentsection, currentsubsection]
\end{columns}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[allowframebreaks]
\frametitle{Index}
\printindex
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
\begin{center}
{\Huge{End}}\\
\vspace{2cm}
\textbf{Tutorial solutions}: \textit{\$TRUST\_ROOT/doc/TRUST/exercices/Tutorial\_solutions.pdf}
\end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{document} 
